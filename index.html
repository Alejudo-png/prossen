<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema Integrado PROSSEN - RH e Controle de Ponto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/imask"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #045696;
        --secondary-color: #0367b8;
        --background-color: #f4f7fc;
        --card-background: #ffffff;
        --text-color: #1e293b;
        --text-light-color: #64748b;
      }

      body {
        font-family: "Segoe UI", sans-serif;
        background-color: var(--background-color);
        color: var(--text-color);
        margin: 0;
        padding: 0;
      }

      .main-container {
        max-width: 1400px;
        margin: auto;
        padding: 1.5rem;
      }

      /* Menu Superior */
      nav {
        background-color: var(--primary-color);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        margin-bottom: 2rem;
      }

      .nav-menu {
        display: flex;
        flex-wrap: wrap;
        list-style: none;
        margin: 0;
        padding: 0;
      }

      .nav-item {
        position: relative;
      }

      .nav-link {
        display: block;
        color: white;
        text-align: center;
        padding: 14px 16px;
        text-decoration: none;
        font-weight: 600;
        transition: background-color 0.3s;
      }

      .nav-link:hover,
      .nav-link.active {
        background-color: var(--secondary-color);
      }

      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 200px;
        box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        border-radius: 5px;
        top: 100%;
        left: 0;
      }

      .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
        text-align: left;
        font-weight: normal;
        border-radius: 5px;
      }

      .dropdown-content a:hover {
        background-color: #f1f1f1;
      }

      .dropdown:hover .dropdown-content {
        display: block;
      }

      /* Views */
      .view {
        display: none;
      }

      .view.active {
        display: block;
      }

      /* Cards e componentes */
      .card {
        background-color: var(--card-background);
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        padding: 25px;
        margin-bottom: 20px;
      }

      /* Forms */
      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 15px 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        margin-bottom: 15px;
      }

      label {
        margin-bottom: 5px;
        font-weight: 600;
        font-size: 0.9rem;
        color: var(--text-color);
      }

      input,
      select,
      textarea {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 1rem;
        background-color: #fff;
        width: 100%;
        box-sizing: border-box;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(4, 86, 150, 0.2);
      }

      input[readonly] {
        background-color: #e9ecef;
        cursor: not-allowed;
      }

      /* Bot√µes */
      .btn {
        padding: 10px 20px;
        font-size: 1rem;
        font-weight: 600;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
        display: inline-block;
        text-align: center;
      }

      .btn-primary {
        background-color: var(--primary-color);
        color: white;
      }

      .btn-primary:hover {
        background-color: var(--secondary-color);
      }

      .btn-success {
        background-color: #28a745;
        color: white;
      }

      .btn-success:hover {
        background-color: #218838;
      }

      .btn-warning {
        background-color: #ffc107;
        color: #212529;
      }

      .btn-warning:hover {
        background-color: #e0a800;
      }

      .btn-danger {
        background-color: #dc3545;
        color: white;
      }

      .btn-danger:hover {
        background-color: #c82333;
      }

      .btn-secondary {
        background-color: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background-color: #5a6268;
      }

      /* Tabelas */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
      }

      th,
      td {
        padding: 12px;
        border: 1px solid #ddd;
        text-align: left;
        font-size: 0.9rem;
      }

      th {
        background-color: #e9ecef;
        font-weight: 600;
      }

      tbody tr:nth-child(odd) {
        background-color: #f8f9fa;
      }

      .action-btn {
        padding: 5px 10px;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.8rem;
        margin: 2px;
      }

      .edit-btn {
        background-color: #007bff;
      }

      .edit-btn:hover {
        background-color: #0056b3;
      }

      .delete-btn {
        background-color: #dc3545;
      }

      .delete-btn:hover {
        background-color: #c82333;
      }

      /* Accordions */
      .accordion-header {
        background-color: var(--primary-color);
        color: white;
        cursor: pointer;
        padding: 15px;
        width: 100%;
        border: none;
        text-align: left;
        font-size: 1.1rem;
        font-weight: bold;
        border-radius: 5px;
        margin-top: 20px;
        transition: background-color 0.3s;
      }

      .accordion-header:hover {
        background-color: var(--secondary-color);
      }

      .panel {
        padding: 0 18px;
        background-color: white;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out;
        border: 1px solid #ddd;
        border-top: none;
        border-radius: 0 0 5px 5px;
      }

      .panel.show {
        padding-top: 20px;
        padding-bottom: 20px;
      }

      /* Modal */
      .modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 40;
        display: none;
      }

      .modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 50;
        display: none;
        width: 90%;
        max-width: 600px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      }

      .modal-lg {
        max-width: 1000px;
      }

      /* Toast */
      .toast {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 5px;
        color: white;
        font-weight: 600;
        z-index: 1000;
        transform: translateX(400px);
        transition: transform 0.3s;
      }

      .toast.show {
        transform: translateX(0);
      }

      .toast.success {
        background-color: #28a745;
      }

      .toast.error {
        background-color: #dc3545;
      }

      /* Estilo do certificado */
      .certificado-container {
        width: 210mm;
        height: 297mm;
        padding: 20mm;
        font-family: Tahoma, Arial, sans-serif;
        border: 2px solid #045696;
        background-color: #fff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        position: relative;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
      }

      .certificado-logo {
        margin-bottom: 1rem;
      }

      .certificado-header {
        font-size: 2rem;
        font-weight: bold;
        color: #045696;
        margin-bottom: 1rem;
        border-bottom: 3px solid #045696;
        padding-bottom: 0.5rem;
        width: 100%;
      }

      .certificado-body {
        font-size: 1.1rem;
        line-height: 1.8;
        margin-bottom: 1.5rem;
        color: #1e293b;
        text-align: justify;
      }

      .certificado-body p {
        margin-bottom: 0.8rem;
      }

      .certificado-body .text-center {
        text-align: center;
      }

      .certificado-footer {
        width: 100%;
        display: flex;
        justify-content: space-around;
        align-items: flex-start;
        margin-top: auto;
        padding-top: 2rem;
      }

      .certificado-footer .assinatura {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 40%;
      }

      .certificado-footer .assinatura-linha {
        width: 100%;
        height: 1px;
        background-color: #000;
        margin-bottom: 10px;
      }

      .assinatura-dados {
        font-size: 0.85rem;
        line-height: 1.4;
        text-align: center;
      }

      .certificado-footer .assinatura-data {
        width: 100%;
        text-align: center;
        font-size: 0.9rem;
        margin-top: 1.5rem;
      }

      .certificado-content-list {
        margin-top: 0.5rem;
        text-align: left;
        font-size: 0.95rem;
        padding-left: 1.5rem;
      }

      .certificado-content-list li {
        margin-bottom: 0.3rem;
        list-style-type: none;
      }

      /* Utilit√°rios */
      .hidden {
        display: none !important;
      }

      .full-width {
        grid-column: 1 / -1;
      }

      .text-center {
        text-align: center;
      }

      .mt-4 {
        margin-top: 1rem;
      }
      .mb-4 {
        margin-bottom: 1rem;
      }
      .p-4 {
        padding: 1rem;
      }

      /* Responsividade */
      @media (max-width: 768px) {
        .nav-menu {
          flex-direction: column;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        .main-container {
          padding: 1rem;
        }

        .certificado-container {
          width: 100%;
          height: auto;
          padding: 10mm;
        }
      }

      /* Estilos espec√≠ficos para impress√£o */
      @media print {
        body,
        .card {
          margin: 0;
          padding: 0;
          box-shadow: none;
          border: none;
        }

        nav,
        .btn,
        .action-btn,
        .modal-backdrop,
        .modal,
        .toast {
          display: none !important;
        }

        .modal-lg {
          width: 100% !important;
          max-width: 100% !important;
          left: 0;
          top: 0;
          transform: none;
          height: 100vh;
          display: block !important;
        }

        .modal-body > * {
          width: 100%;
          height: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="main-container">
      <header class="mb-8">
        <h1 class="text-4xl font-bold" style="color: var(--primary-color)">
          PROSSEN - Sistema Integrado
        </h1>
        <p class="text-gray-600">
          Recursos Humanos e Controle de Ponto Unificados
        </p>
      </header>

      <nav>
        <ul class="nav-menu">
          <li class="nav-item dropdown">
            <a href="javascript:void(0)" class="nav-link">
              <i class="fas fa-users mr-2"></i>RECURSOS HUMANOS
            </a>
            <div class="dropdown-content">
              <a href="#" class="nav-link-sub active" data-view="funcionarios">
                <i class="fas fa-user mr-2"></i>Funcion√°rios
              </a>
              <a href="#" class="nav-link-sub" data-view="cargos">
                <i class="fas fa-briefcase mr-2"></i>Cargos
              </a>
              <a href="#" class="nav-link-sub" data-view="nrs">
                <i class="fas fa-shield-alt mr-2"></i>NRs
              </a>
              <a href="#" class="nav-link-sub" data-view="treinamentos">
                <i class="fas fa-graduation-cap mr-2"></i>Treinamentos
              </a>
              <a href="#" class="nav-link-sub" data-view="instrutores">
                <i class="fas fa-chalkboard-teacher mr-2"></i>Instrutores
              </a>
              <a href="#" class="nav-link-sub" data-view="certificados">
                <i class="fas fa-certificate mr-2"></i>Emiss√£o de Certificados
              </a>
              <a
                href="#"
                class="nav-link-sub"
                data-view="historico-treinamentos"
              >
                <i class="fas fa-history mr-2"></i>Hist√≥rico de Treinamentos
              </a>
            </div>
          </li>

          <li class="nav-item dropdown">
            <a href="javascript:void(0)" class="nav-link">
              <i class="fas fa-clock mr-2"></i>CONTROLE DE PONTO
            </a>
            <div class="dropdown-content">
              <a href="#" class="nav-link-sub" data-view="lancamento-horas">
                <i class="fas fa-clock mr-2"></i>Lan√ßamento de Horas
              </a>
              <a href="#" class="nav-link-sub" data-view="rdo">
                <i class="fas fa-clipboard-list mr-2"></i>RDO
              </a>
              <a href="#" class="nav-link-sub" data-view="turmas">
                <i class="fas fa-users-cog mr-2"></i>Turmas
              </a>
              <a href="#" class="nav-link-sub" data-view="projetos">
                <i class="fas fa-building mr-2"></i>Projetos
              </a>
              <a href="#" class="nav-link-sub" data-view="clientes">
                <i class="fas fa-handshake mr-2"></i>Clientes
              </a>
              <a href="#" class="nav-link-sub" data-view="relatorios-ponto">
                <i class="fas fa-chart-line mr-2"></i>Relat√≥rios de Ponto
              </a>
            </div>
          </li>

          <li class="nav-item dropdown">
            <a href="javascript:void(0)" class="nav-link">
              <i class="fas fa-cogs mr-2"></i>SERVI√áOS
            </a>
            <div class="dropdown-content">
              <a href="#" class="nav-link-sub" data-view="backup">
                <i class="fas fa-save mr-2"></i>Backup e Restaura√ß√£o
              </a>
              <a href="#" class="nav-link-sub" data-view="importacao">
                <i class="fas fa-upload mr-2"></i>Importa√ß√£o de Dados
              </a>
              <a href="#" class="nav-link-sub" data-view="exportacao">
                <i class="fas fa-download mr-2"></i>Exporta√ß√£o de Dados
              </a>
            </div>
          </li>
        </ul>
      </nav>

      <main>
        <!-- VIEW: Funcion√°rios -->
        <div id="funcionarios-view" class="view active">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4">
              Cadastro de Funcion√°rios
            </h2>
            <form id="employee-form">
              <button type="button" class="accordion-header">
                Informa√ß√µes Pessoais
              </button>
              <div class="panel show">
                <div class="form-grid">
                  <div class="form-group">
                    <label for="matricula">MATR√çCULA (autom√°tica)</label>
                    <input type="text" id="matricula" readonly />
                  </div>
                  <div class="form-group">
                    <label for="nome">NOME *</label>
                    <input type="text" id="nome" required />
                  </div>
                  <div class="form-group">
                    <label for="sobrenome">SOBRENOME</label>
                    <input type="text" id="sobrenome" />
                  </div>
                  <div class="form-group">
                    <label for="telefone">TELEFONE</label>
                    <input
                      type="text"
                      id="telefone"
                      placeholder="(00) 00000-0000"
                    />
                  </div>
                  <div class="form-group">
                    <label for="email">EMAIL</label>
                    <input
                      type="email"
                      id="email"
                      placeholder="seu@email.com"
                    />
                  </div>
                  <div class="form-group">
                    <label for="data_nascimento">DATA DE NASCIMENTO</label>
                    <input
                      type="text"
                      id="data_nascimento"
                      placeholder="DD/MM/AAAA"
                    />
                  </div>
                  <div class="form-group">
                    <label for="idade">IDADE (calculada)</label>
                    <input type="text" id="idade" readonly />
                  </div>
                  <div class="form-group">
                    <label for="sexo">SEXO</label>
                    <select id="sexo">
                      <option value="">Selecione</option>
                      <option>Masculino</option>
                      <option>Feminino</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="raca">RA√áA/COR</label>
                    <select id="raca">
                      <option value="">Selecione</option>
                      <option>Branca</option>
                      <option>Preta</option>
                      <option>Parda</option>
                      <option>Amarela</option>
                      <option>Ind√≠gena</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="estado_civil">ESTADO CIVIL</label>
                    <select id="estado_civil">
                      <option value="">Selecione</option>
                      <option>Solteiro(a)</option>
                      <option>Casado(a)</option>
                      <option>Divorciado(a)</option>
                      <option>Vi√∫vo(a)</option>
                      <option>Uni√£o Est√°vel</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="naturalidade">NATURALIDADE (Cidade)</label>
                    <input type="text" id="naturalidade" />
                  </div>
                  <div class="form-group">
                    <label for="uf3">UF NATURALIDADE</label>
                    <select id="uf3">
                      <option value="" selected>Selecione...</option>
                      <option value="AC">Acre</option>
                      <option value="AL">Alagoas</option>
                      <option value="AP">Amap√°</option>
                      <option value="AM">Amazonas</option>
                      <option value="BA">Bahia</option>
                      <option value="CE">Cear√°</option>
                      <option value="DF">Distrito Federal</option>
                      <option value="ES">Esp√≠rito Santo</option>
                      <option value="GO">Goi√°s</option>
                      <option value="MA">Maranh√£o</option>
                      <option value="MT">Mato Grosso</option>
                      <option value="MS">Mato Grosso do Sul</option>
                      <option value="MG">Minas Gerais</option>
                      <option value="PA">Par√°</option>
                      <option value="PB">Para√≠ba</option>
                      <option value="PR">Paran√°</option>
                      <option value="PE">Pernambuco</option>
                      <option value="PI">Piau√≠</option>
                      <option value="RJ">Rio de Janeiro</option>
                      <option value="RN">Rio Grande do Norte</option>
                      <option value="RS">Rio Grande do Sul</option>
                      <option value="RO">Rond√¥nia</option>
                      <option value="RR">Roraima</option>
                      <option value="SC">Santa Catarina</option>
                      <option value="SP">S√£o Paulo</option>
                      <option value="SE">Sergipe</option>
                      <option value="TO">Tocantins</option>
                    </select>
                  </div>
                  <div class="form-group full-width">
                    <label for="nome_pai">NOME DO PAI</label>
                    <input type="text" id="nome_pai" />
                  </div>
                  <div class="form-group full-width">
                    <label for="nome_mae">NOME DA M√ÉE</label>
                    <input list="maes-lista" id="nome_mae" name="nome_mae" />
                    <datalist id="maes-lista"></datalist>
                  </div>
                </div>
              </div>

              <button type="button" class="accordion-header">Documentos</button>
              <div class="panel">
                <div class="form-grid">
                  <div class="form-group">
                    <label for="cpf">CPF *</label>
                    <input
                      type="text"
                      id="cpf"
                      placeholder="000.000.000-00"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label for="rg">RG</label>
                    <input type="text" id="rg" />
                  </div>
                  <div class="form-group">
                    <label for="org_emissor">√ìRG√ÉO EMISSOR</label>
                    <input type="text" id="org_emissor" />
                  </div>
                  <div class="form-group">
                    <label for="data_emissao">DATA DE EMISS√ÉO</label>
                    <input
                      type="text"
                      id="data_emissao"
                      placeholder="DD/MM/AAAA"
                    />
                  </div>
                  <div class="form-group">
                    <label for="pis">PIS/PASEP</label>
                    <input type="text" id="pis" placeholder="000.00000.00-0" />
                  </div>
                  <div class="form-group">
                    <label for="titulo_eleitor">T√çTULO DE ELEITOR</label>
                    <input type="text" id="titulo_eleitor" />
                  </div>
                  <div class="form-group">
                    <label for="zona">ZONA</label>
                    <input type="text" id="zona" maxlength="4" />
                  </div>
                  <div class="form-group">
                    <label for="secao">SE√á√ÉO</label>
                    <input type="text" id="secao" maxlength="4" />
                  </div>
                </div>
              </div>

              <button type="button" class="accordion-header">Endere√ßo</button>
              <div class="panel">
                <div class="form-grid">
                  <div class="form-group">
                    <label for="cep">CEP</label>
                    <input type="text" id="cep" placeholder="00000-000" />
                  </div>
                  <div class="form-group full-width">
                    <label for="rua">NOME DA RUA</label>
                    <input type="text" id="rua" />
                  </div>
                  <div class="form-group">
                    <label for="numero">N√öMERO</label>
                    <input type="text" id="numero" />
                  </div>
                  <div class="form-group">
                    <label for="complemento">COMPLEMENTO</label>
                    <input type="text" id="complemento" />
                  </div>
                  <div class="form-group">
                    <label for="bairro">BAIRRO</label>
                    <input type="text" id="bairro" />
                  </div>
                  <div class="form-group">
                    <label for="cidade">CIDADE</label>
                    <input type="text" id="cidade" />
                  </div>
                  <div class="form-group">
                    <label for="uf2">UF</label>
                    <select id="uf2">
                      <option value="" selected>Selecione...</option>
                      <option value="AC">Acre</option>
                      <option value="AL">Alagoas</option>
                      <option value="AP">Amap√°</option>
                      <option value="AM">Amazonas</option>
                      <option value="BA">Bahia</option>
                      <option value="CE">Cear√°</option>
                      <option value="DF">Distrito Federal</option>
                      <option value="ES">Esp√≠rito Santo</option>
                      <option value="GO">Goi√°s</option>
                      <option value="MA">Maranh√£o</option>
                      <option value="MT">Mato Grosso</option>
                      <option value="MS">Mato Grosso do Sul</option>
                      <option value="MG">Minas Gerais</option>
                      <option value="PA">Par√°</option>
                      <option value="PB">Para√≠ba</option>
                      <option value="PR">Paran√°</option>
                      <option value="PE">Pernambuco</option>
                      <option value="PI">Piau√≠</option>
                      <option value="RJ">Rio de Janeiro</option>
                      <option value="RN">Rio Grande do Norte</option>
                      <option value="RS">Rio Grande do Sul</option>
                      <option value="RO">Rond√¥nia</option>
                      <option value="RR">Roraima</option>
                      <option value="SC">Santa Catarina</option>
                      <option value="SP">S√£o Paulo</option>
                      <option value="SE">Sergipe</option>
                      <option value="TO">Tocantins</option>
                    </select>
                  </div>
                </div>
              </div>

              <button type="button" class="accordion-header">
                Dados Contratuais e Profissionais
              </button>
              <div class="panel">
                <div class="form-grid">
                  <div class="form-group">
                    <label for="matricula_esocial">MATR√çCULA ESOCIAL</label>
                    <input type="text" id="matricula_esocial" />
                  </div>
                  <div class="form-group">
                    <label for="setor">SETOR</label>
                    <input type="text" id="setor" />
                  </div>
                  <div class="form-group">
                    <label for="cargo">CARGO/FUN√á√ÉO</label>
                    <input list="cargos-lista" id="cargo" name="cargo" />
                    <datalist id="cargos-lista"></datalist>
                  </div>
                  <div class="form-group">
                    <label for="nivel_cargo">N√çVEL</label>
                    <select id="nivel_cargo">
                      <option value="" selected>Selecione...</option>
                      <option value="J√∫nior">J√∫nior</option>
                      <option value="Pleno">Pleno</option>
                      <option value="S√™nior">S√™nior</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="cbo">CBO</label>
                    <input type="text" id="cbo" placeholder="0000-00" />
                  </div>
                  <div class="form-group">
                    <label for="data_admissao">DATA ADMISS√ÉO</label>
                    <input
                      type="text"
                      id="data_admissao"
                      placeholder="DD/MM/AAAA"
                    />
                  </div>
                  <div class="form-group">
                    <label for="tipo_contrato">TIPO DE CONTRATO</label>
                    <select id="tipo_contrato">
                      <option value="" selected>Selecione...</option>
                      <option value="fixo">Fixo</option>
                      <option value="intermitente">Intermitente</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="salario">SAL√ÅRIO</label>
                    <input
                      type="text"
                      id="salario"
                      placeholder="R$ 0,00"
                      readonly
                    />
                  </div>
                  <div class="form-group">
                    <label for="valor_hora">VALOR DA HORAS</label>
                    <input
                      type="text"
                      id="valor_hora"
                      placeholder="R$ 0,00"
                      readonly
                    />
                  </div>
                  <div class="form-group">
                    <label for="vale_alimentacao">VALE ALIMENTA√á√ÉO</label>
                    <input
                      type="text"
                      id="vale_alimentacao"
                      placeholder="R$ 0,00"
                    />
                  </div>
                  <div class="form-group">
                    <label for="cesta_basica">CESTA B√ÅSICA</label>
                    <input
                      type="text"
                      id="cesta_basica"
                      placeholder="R$ 0,00"
                    />
                  </div>
                  <div class="form-group">
                    <label for="horario_trabalho">HOR√ÅRIO DE TRABALHO</label>
                    <input
                      type="text"
                      id="horario_trabalho"
                      placeholder="08:00 √†s 18:00"
                    />
                  </div>
                  <div class="form-group">
                    <label for="tipo_trabalho">TIPO DE TRABALHO</label>
                    <select id="tipo_trabalho">
                      <option value="">Selecione</option>
                      <option>Presencial</option>
                      <option>H√≠brido</option>
                      <option>Remoto</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="experiencia">EXPERI√äNCIA</label>
                    <select id="experiencia">
                      <option value="" selected>Selecione...</option>
                      <option value="30 dias">30 dias</option>
                      <option value="45 dias">45 dias</option>
                      <option value="90 dias">90 dias</option>
                      <option value="30 + 30 dias">30 + 30 dias</option>
                      <option value="45 + 45 dias">45 + 45 dias</option>
                      <option value="60 + 30 dias">60 + 30 dias</option>
                      <option value="N√£o se aplica">N√£o se aplica</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="escolaridade">ESCOLARIDADE/FORMA√á√ÉO</label>
                    <input type="text" id="escolaridade" />
                  </div>
                  <div class="form-group">
                    <label for="classificacao">CLASSIFICA√á√ÉO</label>
                    <select id="classificacao">
                      <option value="Direto">Direto</option>
                      <option value="Indireto">Indireto</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="status">STATUS</label>
                    <select id="status">
                      <option value="ativo">Ativo</option>
                      <option value="inativo">Inativo</option>
                    </select>
                  </div>
                  <div class="form-group full-width">
                    <label for="dados_bancarios">DADOS BANC√ÅRIOS (PIX)</label>
                    <input type="text" id="dados_bancarios" />
                  </div>
                </div>
              </div>

              <button type="button" class="accordion-header">
                Dependentes
              </button>
              <div class="panel">
                <div class="form-grid">
                  <div class="form-group">
                    <label for="nome_conjuge">NOME DO C√îNJUGE</label>
                    <input type="text" id="nome_conjuge" />
                  </div>
                  <div class="form-group">
                    <label for="nascimento_conjuge"
                      >DATA NASCIMENTO C√îNJUGE</label
                    >
                    <input
                      type="text"
                      id="nascimento_conjuge"
                      placeholder="DD/MM/AAAA"
                    />
                  </div>
                  <div class="form-group">
                    <label for="cpf_conjuge">CPF C√îNJUGE</label>
                    <input
                      type="text"
                      id="cpf_conjuge"
                      placeholder="000.000.000-00"
                    />
                  </div>
                </div>

                <hr style="margin: 20px 0" />

                <div class="form-grid">
                  <div class="form-group">
                    <label for="nome_filho1">FILHO/DEPENDENTE 01</label>
                    <input type="text" id="nome_filho1" />
                  </div>
                  <div class="form-group">
                    <label for="nascimento_filho1">DATA DE NASCIMENTO</label>
                    <input
                      type="text"
                      id="nascimento_filho1"
                      placeholder="DD/MM/AAAA"
                    />
                  </div>
                  <div class="form-group">
                    <label for="cpf_filho1">CPF</label>
                    <input
                      type="text"
                      id="cpf_filho1"
                      placeholder="000.000.000-00"
                    />
                  </div>
                </div>

                <hr style="margin: 20px 0" />

                <div class="form-grid">
                  <div class="form-group">
                    <label for="nome_filho2">FILHO/DEPENDENTE 02</label>
                    <input type="text" id="nome_filho2" />
                  </div>
                  <div class="form-group">
                    <label for="nascimento_filho2">DATA DE NASCIMENTO</label>
                    <input
                      type="text"
                      id="nascimento_filho2"
                      placeholder="DD/MM/AAAA"
                    />
                  </div>
                  <div class="form-group">
                    <label for="cpf_filho2">CPF</label>
                    <input
                      type="text"
                      id="cpf_filho2"
                      placeholder="000.000.000-00"
                    />
                  </div>
                </div>

                <hr style="margin: 20px 0" />

                <div class="form-grid">
                  <div class="form-group">
                    <label for="nome_filho3">FILHO/DEPENDENTE 03</label>
                    <input type="text" id="nome_filho3" />
                  </div>
                  <div class="form-group">
                    <label for="nascimento_filho3">DATA DE NASCIMENTO</label>
                    <input
                      type="text"
                      id="nascimento_filho3"
                      placeholder="DD/MM/AAAA"
                    />
                  </div>
                  <div class="form-group">
                    <label for="cpf_filho3">CPF</label>
                    <input
                      type="text"
                      id="cpf_filho3"
                      placeholder="000.000.000-00"
                    />
                  </div>
                </div>
              </div>

              <button type="submit" class="btn btn-success full-width mt-4">
                <i class="fas fa-save mr-2"></i>Salvar Funcion√°rio
              </button>
            </form>

            <hr class="my-8" />

            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xl font-semibold">Funcion√°rios Cadastrados</h3>
              <div class="flex gap-2">
                <input
                  type="text"
                  id="filter-nome"
                  placeholder="Filtrar por nome..."
                  class="px-3 py-2 border rounded-md"
                />
                <input
                  type="text"
                  id="filter-cpf"
                  placeholder="Filtrar por CPF..."
                  class="px-3 py-2 border rounded-md"
                />
              </div>
            </div>

            <div class="overflow-x-auto">
              <table id="employee-table">
                <thead>
                  <tr>
                    <th>Matr√≠cula</th>
                    <th>Nome</th>
                    <th>CPF</th>
                    <th>Cargo</th>
                    <th>Status</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- VIEW: Cargos -->
        <div id="cargos-view" class="view">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4">Cadastro de Cargos</h2>
            <form id="cargo-form" class="mb-8">
              <div class="form-grid">
                <div class="form-group">
                  <label for="cargo-nome">Nome do Cargo *</label>
                  <input type="text" id="cargo-nome" required />
                </div>
              </div>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save mr-2"></i>Salvar Cargo
              </button>
            </form>

            <div class="overflow-x-auto">
              <table id="cargos-table">
                <thead>
                  <tr>
                    <th>Cargo</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- VIEW: NRs -->
        <div id="nrs-view" class="view">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4">
              Normas Regulamentadoras (NRs)
            </h2>
            <form id="nr-form" class="mb-8">
              <div class="form-grid">
                <div class="form-group">
                  <label for="nr-codigo">C√≥digo da NR *</label>
                  <input
                    type="text"
                    id="nr-codigo"
                    placeholder="Ex: NR-35"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="nr-descricao">Descri√ß√£o *</label>
                  <input
                    type="text"
                    id="nr-descricao"
                    placeholder="Ex: Trabalho em Altura"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="nr-carga-horaria">Carga Hor√°ria (h) *</label>
                  <input type="number" id="nr-carga-horaria" min="1" required />
                </div>
                <div class="form-group">
                  <label for="nr-validade">Validade (meses) *</label>
                  <input
                    type="number"
                    id="nr-validade"
                    value="12"
                    min="1"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="nr-frequencia">Frequ√™ncia (%)</label>
                  <input
                    type="number"
                    id="nr-frequencia"
                    value="100"
                    min="0"
                    max="100"
                  />
                </div>
              </div>
              <div class="form-group">
                <label for="nr-objetivo">Objetivo do Treinamento *</label>
                <textarea id="nr-objetivo" rows="3" required></textarea>
              </div>
              <div class="form-group">
                <label for="nr-conteudo-programatico"
                  >Conte√∫do Program√°tico *</label
                >
                <textarea
                  id="nr-conteudo-programatico"
                  rows="5"
                  required
                ></textarea>
              </div>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save mr-2"></i>Salvar NR
              </button>
            </form>

            <div class="overflow-x-auto">
              <table id="nrs-table">
                <thead>
                  <tr>
                    <th>C√≥digo</th>
                    <th>Descri√ß√£o</th>
                    <th>Carga Hor√°ria</th>
                    <th>Validade</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- VIEW: Treinamentos -->
        <div id="treinamentos-view" class="view">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4">Treinamentos Especiais</h2>
            <form id="treinamento-form" class="mb-8">
              <div class="form-grid">
                <div class="form-group">
                  <label for="te-codigo">C√≥digo do Treinamento *</label>
                  <input
                    type="text"
                    id="te-codigo"
                    placeholder="Ex: TE-01"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="te-descricao">Descri√ß√£o *</label>
                  <input
                    type="text"
                    id="te-descricao"
                    placeholder="Ex: Opera√ß√£o PTA"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="te-carga-horaria">Carga Hor√°ria (h) *</label>
                  <input type="number" id="te-carga-horaria" min="1" required />
                </div>
                <div class="form-group">
                  <label for="te-validade">Validade (meses) *</label>
                  <input
                    type="number"
                    id="te-validade"
                    value="12"
                    min="1"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="te-frequencia">Frequ√™ncia (%)</label>
                  <input
                    type="number"
                    id="te-frequencia"
                    value="100"
                    min="0"
                    max="100"
                  />
                </div>
              </div>
              <div class="form-group">
                <label for="te-objetivo">Objetivo do Treinamento *</label>
                <textarea id="te-objetivo" rows="3" required></textarea>
              </div>
              <div class="form-group">
                <label for="te-conteudo-programatico"
                  >Conte√∫do Program√°tico *</label
                >
                <textarea
                  id="te-conteudo-programatico"
                  rows="5"
                  required
                ></textarea>
              </div>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save mr-2"></i>Salvar Treinamento
              </button>
            </form>

            <div class="overflow-x-auto">
              <table id="treinamentos-table">
                <thead>
                  <tr>
                    <th>C√≥digo</th>
                    <th>Descri√ß√£o</th>
                    <th>Carga Hor√°ria</th>
                    <th>Validade</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- VIEW: Instrutores -->
        <div id="instrutores-view" class="view">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4">Cadastro de Instrutores</h2>
            <form id="instrutor-form" class="mb-8">
              <div class="form-grid">
                <div class="form-group">
                  <label for="instrutor-nome">Nome Completo *</label>
                  <input type="text" id="instrutor-nome" required />
                </div>
                <div class="form-group">
                  <label for="instrutor-cpf">CPF *</label>
                  <input
                    type="text"
                    id="instrutor-cpf"
                    placeholder="000.000.000-00"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="instrutor-habilitacao"
                    >Habilita√ß√£o Profissional *</label
                  >
                  <input
                    type="text"
                    id="instrutor-habilitacao"
                    placeholder="Ex: CREA/SP 123456"
                    required
                  />
                </div>
              </div>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save mr-2"></i>Salvar Instrutor
              </button>
            </form>

            <div class="overflow-x-auto">
              <table id="instrutores-table">
                <thead>
                  <tr>
                    <th>Nome</th>
                    <th>CPF</th>
                    <th>Habilita√ß√£o</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- VIEW: Certificados -->
        <div id="certificados-view" class="view">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4">Emiss√£o de Certificados</h2>
            <form id="certificado-form" class="mb-8">
              <div class="form-grid">
                <div class="form-group">
                  <label for="certificado-funcionario">Funcion√°rio *</label>
                  <select id="certificado-funcionario" required>
                    <option value="">Selecione um funcion√°rio</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="certificado-treinamento-tipo"
                    >Tipo de Treinamento *</label
                  >
                  <select id="certificado-treinamento-tipo" required>
                    <option value="">Selecione o tipo</option>
                    <option value="nr">NR (Norma Regulamentadora)</option>
                    <option value="te">TE (Treinamento Especial)</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="certificado-treinamento">Treinamento *</label>
                  <select id="certificado-treinamento" required disabled>
                    <option value="">Selecione um treinamento</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="certificado-instrutor">Instrutor *</label>
                  <select id="certificado-instrutor" required>
                    <option value="">Selecione um instrutor</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="certificado-data">Data do Treinamento *</label>
                  <input type="date" id="certificado-data" required />
                </div>
              </div>
              <button type="submit" class="btn btn-primary mt-4">
                <i class="fas fa-award mr-2"></i>Gerar Certificado e Salvar
                Hist√≥rico
              </button>
            </form>
            <p class="text-sm text-gray-600">
              Ap√≥s a gera√ß√£o, o certificado ser√° exibido e um registro ser√°
              salvo automaticamente.
            </p>
          </div>
        </div>

        <!-- VIEW: Hist√≥rico de Treinamentos -->
        <div id="historico-treinamentos-view" class="view">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4">
              Hist√≥rico de Treinamentos
            </h2>

            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xl font-semibold">Registros</h3>
              <div class="flex gap-2">
                <div class="form-group mb-0">
                  <label for="filtro-vencimento" class="text-sm"
                    >Vencimento</label
                  >
                  <select id="filtro-vencimento">
                    <option value="todos">Todos</option>
                    <option value="vencendo">
                      A Vencer (pr√≥ximos 3 meses)
                    </option>
                    <option value="vencidos">Vencidos</option>
                  </select>
                </div>
                <input
                  type="text"
                  id="filtro-historico"
                  placeholder="Filtrar por nome..."
                  class="px-3 py-2 border rounded-md"
                />
              </div>
            </div>

            <div class="overflow-x-auto">
              <table id="historico-treinamentos-table">
                <thead>
                  <tr>
                    <th>Funcion√°rio</th>
                    <th>Treinamento</th>
                    <th>Instrutor</th>
                    <th>Data</th>
                    <th>Validade</th>
                    <th>Status</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- VIEW: Lan√ßamento de Horas -->
        <div id="lancamento-horas-view" class="view">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4">Lan√ßamento de Horas</h2>
            <div class="form-grid mb-6">
              <div class="form-group">
                <label for="lancamento-data">Data do Trabalho *</label>
                <input type="date" id="lancamento-data" required />
              </div>
              <div class="form-group">
                <label for="lancamento-turma">Turma *</label>
                <select id="lancamento-turma" required>
                  <option value="">Selecione uma turma</option>
                </select>
              </div>
              <div class="form-group">
                <label for="lancamento-projeto">Projeto *</label>
                <select id="lancamento-projeto" required>
                  <option value="">Selecione um projeto</option>
                </select>
              </div>
            </div>
            <button id="carregar-turma-btn" class="btn btn-primary mb-4">
              <i class="fas fa-users mr-2"></i>Carregar Pessoas da Turma
            </button>

            <div id="lista-pessoas-lancamento"></div>
          </div>
        </div>

        <!-- VIEW: RDO -->
        <div id="rdo-view" class="view">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4">
              Relat√≥rios Di√°rios de Obra (RDO)
            </h2>
            <p class="text-gray-600 mb-4">
              Funcionalidade em desenvolvimento - ser√° implementada na pr√≥xima
              vers√£o
            </p>
          </div>
        </div>

        <!-- VIEW: Turmas -->
        <div id="turmas-view" class="view">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4">Gerenciamento de Turmas</h2>
            <form id="turma-form" class="mb-8">
              <div class="form-grid">
                <div class="form-group">
                  <label for="turma-codinome">Codinome da Turma *</label>
                  <input type="text" id="turma-codinome" required />
                </div>
                <div class="form-group">
                  <label for="turma-descricao">Descri√ß√£o</label>
                  <input type="text" id="turma-descricao" />
                </div>
                <div class="form-group">
                  <label for="turma-entrada">Hor√°rio de Entrada</label>
                  <input type="time" id="turma-entrada" value="07:30" />
                </div>
                <div class="form-group">
                  <label for="turma-saida">Hor√°rio de Sa√≠da</label>
                  <input type="time" id="turma-saida" value="17:30" />
                </div>
              </div>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save mr-2"></i>Salvar Turma
              </button>
            </form>

            <div class="overflow-x-auto">
              <table id="turmas-table">
                <thead>
                  <tr>
                    <th>Codinome</th>
                    <th>Descri√ß√£o</th>
                    <th>Hor√°rio</th>
                    <th>Membros</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- VIEW: Projetos -->
        <div id="projetos-view" class="view">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4">
              Gerenciamento de Projetos
            </h2>
            <form id="projeto-form" class="mb-8">
              <div class="form-grid">
                <div class="form-group">
                  <label for="projeto-numero">N√∫mero do Projeto *</label>
                  <input
                    type="number"
                    id="projeto-numero"
                    min="10000"
                    max="99999"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="projeto-cliente">Cliente *</label>
                  <select id="projeto-cliente" required>
                    <option value="">Selecione um cliente</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label for="projeto-descricao">Descri√ß√£o do Projeto *</label>
                <textarea id="projeto-descricao" rows="3" required></textarea>
              </div>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save mr-2"></i>Salvar Projeto
              </button>
            </form>

            <div class="overflow-x-auto">
              <table id="projetos-table">
                <thead>
                  <tr>
                    <th>N√∫mero</th>
                    <th>Descri√ß√£o</th>
                    <th>Cliente</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- VIEW: Clientes -->
        <div id="clientes-view" class="view">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4">
              Gerenciamento de Clientes
            </h2>
            <form id="cliente-form" class="mb-8">
              <div class="form-grid">
                <div class="form-group">
                  <label for="cliente-nome">Nome do Cliente *</label>
                  <input type="text" id="cliente-nome" required />
                </div>
                <div class="form-group">
                  <label for="cliente-cidade">Cidade</label>
                  <input type="text" id="cliente-cidade" />
                </div>
                <div class="form-group">
                  <label for="cliente-estado">Estado (UF)</label>
                  <input type="text" id="cliente-estado" maxlength="2" />
                </div>
              </div>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save mr-2"></i>Salvar Cliente
              </button>
            </form>

            <div class="overflow-x-auto">
              <table id="clientes-table">
                <thead>
                  <tr>
                    <th>Nome</th>
                    <th>Cidade</th>
                    <th>Estado</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- VIEW: Relat√≥rios de Ponto -->
        <div id="relatorios-ponto-view" class="view">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4">Relat√≥rios de Ponto</h2>

            <!-- Filtros -->
            <div class="bg-gray-50 p-4 rounded-lg mb-6">
              <h3 class="text-lg font-semibold mb-3">Filtros</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="form-group">
                  <label for="filtro-data-inicio">Data In√≠cio</label>
                  <input
                    type="date"
                    id="filtro-data-inicio"
                    class="mt-1 block w-full rounded-md border-gray-300"
                  />
                </div>
                <div class="form-group">
                  <label for="filtro-data-fim">Data Fim</label>
                  <input
                    type="date"
                    id="filtro-data-fim"
                    class="mt-1 block w-full rounded-md border-gray-300"
                  />
                </div>
                <div class="form-group">
                  <label for="filtro-funcionario">Funcion√°rio</label>
                  <select
                    id="filtro-funcionario"
                    class="mt-1 block w-full rounded-md border-gray-300"
                  >
                    <option value="">Todos os funcion√°rios</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="filtro-turma-relatorio">Turma</label>
                  <select
                    id="filtro-turma-relatorio"
                    class="mt-1 block w-full rounded-md border-gray-300"
                  >
                    <option value="">Todas as turmas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="filtro-projeto-relatorio">Projeto</label>
                  <select
                    id="filtro-projeto-relatorio"
                    class="mt-1 block w-full rounded-md border-gray-300"
                  >
                    <option value="">Todos os projetos</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>&nbsp;</label>
                  <div class="flex gap-2">
                    <button
                      id="aplicar-filtros-btn"
                      class="btn btn-primary flex-1"
                    >
                      <i class="fas fa-filter mr-2"></i>Aplicar Filtros
                    </button>
                    <button id="limpar-filtros-btn" class="btn btn-secondary">
                      <i class="fas fa-eraser mr-2"></i>Limpar
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Resultados -->
            <div id="relatorio-resultados">
              <div class="flex justify-between items-center mb-4">
                <div>
                  <span id="total-registros" class="text-gray-600"
                    >Nenhum registro encontrado</span
                  >
                  <span
                    id="total-horas"
                    class="ml-4 font-bold text-blue-600"
                  ></span>
                </div>
                <button
                  id="exportar-csv-relatorio-btn"
                  class="btn btn-success"
                  style="display: none"
                >
                  <i class="fas fa-file-csv mr-2"></i>Exportar CSV
                </button>
              </div>

              <div class="overflow-x-auto">
                <table id="relatorio-ponto-table" class="w-full">
                  <thead>
                    <tr class="border-b bg-gray-100">
                      <th class="p-3 text-left">Data</th>
                      <th class="p-3 text-left">Funcion√°rio</th>
                      <th class="p-3 text-left">Turma</th>
                      <th class="p-3 text-left">Projeto</th>
                      <th class="p-3 text-left">Entrada</th>
                      <th class="p-3 text-left">Sa√≠da</th>
                      <th class="p-3 text-right">Horas</th>
                      <th class="p-3 text-center">A√ß√µes</th>
                    </tr>
                  </thead>
                  <tbody id="relatorio-ponto-tbody">
                    <tr>
                      <td colspan="8" class="p-8 text-center text-gray-500">
                        Use os filtros acima para gerar um relat√≥rio de ponto
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- VIEW: Backup -->
        <div id="backup-view" class="view">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4">Backup e Restaura√ß√£o</h2>

            <div
              class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-md mb-6"
            >
              <h3 class="font-bold mb-2">Salvamento Autom√°tico</h3>
              <p>
                Todos os dados s√£o salvos automaticamente no seu navegador
                sempre que voc√™ faz altera√ß√µes.
              </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
              <div class="p-6 border rounded-lg">
                <h3 class="text-lg font-semibold mb-3">
                  <i class="fas fa-download mr-2 text-blue-600"></i>Exportar
                  Dados
                </h3>
                <p class="text-gray-600 mb-4">
                  Fa√ßa download de todos os dados em um arquivo JSON.
                </p>
                <button id="export-db-btn" class="btn btn-primary w-full">
                  <i class="fas fa-download mr-2"></i>Exportar Backup
                </button>
              </div>

              <div class="p-6 border rounded-lg">
                <h3 class="text-lg font-semibold mb-3">
                  <i class="fas fa-upload mr-2 text-green-600"></i>Importar
                  Dados
                </h3>
                <p class="text-gray-600 mb-4">
                  Restaure dados de um arquivo de backup anteriormente
                  exportado.
                </p>
                <button id="import-db-btn" class="btn btn-success w-full">
                  <i class="fas fa-upload mr-2"></i>Importar Backup
                </button>
              </div>
            </div>

            <div
              class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md mb-4"
            >
              <h3 class="font-bold mb-2">Zona de Perigo</h3>
              <p class="mb-4">
                As a√ß√µes abaixo s√£o irrevers√≠veis e apagar√£o TODOS os dados do
                sistema.
              </p>
              <button id="reset-db-btn" class="btn btn-danger">
                <i class="fas fa-exclamation-triangle mr-2"></i>Resetar Sistema
              </button>
            </div>
          </div>
        </div>

        <!-- VIEW: Importa√ß√£o -->
        <div id="importacao-view" class="view">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4">Importa√ß√£o de Dados</h2>

            <div
              class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-md mb-6"
            >
              <h3 class="font-bold mb-2">
                <i class="fas fa-info-circle mr-2"></i>Instru√ß√µes
              </h3>
              <p>
                Importe dados de arquivos JSON previamente exportados. Os dados
                ser√£o <strong>adicionados</strong> aos existentes (n√£o
                substituir√£o).
              </p>
              <p class="mt-2 text-sm">
                Para substituir completamente os dados, use a op√ß√£o de Backup e
                Restaura√ß√£o.
              </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-blue-700">
                  <i class="fas fa-users mr-2"></i>Funcion√°rios
                </h3>
                <input
                  type="file"
                  id="import-funcionarios"
                  accept=".json"
                  class="hidden"
                />
                <button
                  onclick="document.getElementById('import-funcionarios').click()"
                  class="btn btn-primary w-full"
                >
                  <i class="fas fa-upload mr-2"></i>Importar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros atuais: <span id="count-funcionarios">0</span>
                </p>
              </div>

              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-blue-700">
                  <i class="fas fa-briefcase mr-2"></i>Cargos
                </h3>
                <input
                  type="file"
                  id="import-cargos"
                  accept=".json"
                  class="hidden"
                />
                <button
                  onclick="document.getElementById('import-cargos').click()"
                  class="btn btn-primary w-full"
                >
                  <i class="fas fa-upload mr-2"></i>Importar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros atuais: <span id="count-cargos">0</span>
                </p>
              </div>

              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-blue-700">
                  <i class="fas fa-shield-alt mr-2"></i>NRs
                </h3>
                <input
                  type="file"
                  id="import-nrs"
                  accept=".json"
                  class="hidden"
                />
                <button
                  onclick="document.getElementById('import-nrs').click()"
                  class="btn btn-primary w-full"
                >
                  <i class="fas fa-upload mr-2"></i>Importar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros atuais: <span id="count-nrs">0</span>
                </p>
              </div>

              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-blue-700">
                  <i class="fas fa-graduation-cap mr-2"></i>Treinamentos
                </h3>
                <input
                  type="file"
                  id="import-treinamentos"
                  accept=".json"
                  class="hidden"
                />
                <button
                  onclick="document.getElementById('import-treinamentos').click()"
                  class="btn btn-primary w-full"
                >
                  <i class="fas fa-upload mr-2"></i>Importar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros atuais: <span id="count-treinamentos">0</span>
                </p>
              </div>

              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-blue-700">
                  <i class="fas fa-chalkboard-teacher mr-2"></i>Instrutores
                </h3>
                <input
                  type="file"
                  id="import-instrutores"
                  accept=".json"
                  class="hidden"
                />
                <button
                  onclick="document.getElementById('import-instrutores').click()"
                  class="btn btn-primary w-full"
                >
                  <i class="fas fa-upload mr-2"></i>Importar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros atuais: <span id="count-instrutores">0</span>
                </p>
              </div>

              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-blue-700">
                  <i class="fas fa-handshake mr-2"></i>Clientes
                </h3>
                <input
                  type="file"
                  id="import-clientes"
                  accept=".json"
                  class="hidden"
                />
                <button
                  onclick="document.getElementById('import-clientes').click()"
                  class="btn btn-primary w-full"
                >
                  <i class="fas fa-upload mr-2"></i>Importar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros atuais: <span id="count-clientes">0</span>
                </p>
              </div>

              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-blue-700">
                  <i class="fas fa-building mr-2"></i>Projetos
                </h3>
                <input
                  type="file"
                  id="import-projetos"
                  accept=".json"
                  class="hidden"
                />
                <button
                  onclick="document.getElementById('import-projetos').click()"
                  class="btn btn-primary w-full"
                >
                  <i class="fas fa-upload mr-2"></i>Importar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros atuais: <span id="count-projetos">0</span>
                </p>
              </div>

              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-blue-700">
                  <i class="fas fa-users-cog mr-2"></i>Turmas
                </h3>
                <input
                  type="file"
                  id="import-turmas"
                  accept=".json"
                  class="hidden"
                />
                <button
                  onclick="document.getElementById('import-turmas').click()"
                  class="btn btn-primary w-full"
                >
                  <i class="fas fa-upload mr-2"></i>Importar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros atuais: <span id="count-turmas">0</span>
                </p>
              </div>

              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-blue-700">
                  <i class="fas fa-clock mr-2"></i>Hor√°rios
                </h3>
                <input
                  type="file"
                  id="import-horarios"
                  accept=".json"
                  class="hidden"
                />
                <button
                  onclick="document.getElementById('import-horarios').click()"
                  class="btn btn-primary w-full"
                >
                  <i class="fas fa-upload mr-2"></i>Importar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros atuais: <span id="count-horarios">0</span>
                </p>
              </div>

              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-blue-700">
                  <i class="fas fa-history mr-2"></i>Hist√≥rico Treinamentos
                </h3>
                <input
                  type="file"
                  id="import-historico"
                  accept=".json"
                  class="hidden"
                />
                <button
                  onclick="document.getElementById('import-historico').click()"
                  class="btn btn-primary w-full"
                >
                  <i class="fas fa-upload mr-2"></i>Importar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros atuais: <span id="count-historico">0</span>
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- VIEW: Exporta√ß√£o -->
        <div id="exportacao-view" class="view">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4">Exporta√ß√£o de Dados</h2>

            <div
              class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-md mb-6"
            >
              <h3 class="font-bold mb-2">
                <i class="fas fa-info-circle mr-2"></i>Instru√ß√µes
              </h3>
              <p>
                Exporte cada tabela individualmente em formato JSON. Os arquivos
                podem ser reimportados posteriormente.
              </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-green-700">
                  <i class="fas fa-users mr-2"></i>Funcion√°rios
                </h3>
                <button
                  onclick="exportarTabela('funcionarios')"
                  class="btn btn-success w-full"
                >
                  <i class="fas fa-download mr-2"></i>Exportar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros: <span id="export-count-funcionarios">0</span>
                </p>
              </div>

              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-green-700">
                  <i class="fas fa-briefcase mr-2"></i>Cargos
                </h3>
                <button
                  onclick="exportarTabela('cargos')"
                  class="btn btn-success w-full"
                >
                  <i class="fas fa-download mr-2"></i>Exportar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros: <span id="export-count-cargos">0</span>
                </p>
              </div>

              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-green-700">
                  <i class="fas fa-shield-alt mr-2"></i>NRs
                </h3>
                <button
                  onclick="exportarTabela('nrs')"
                  class="btn btn-success w-full"
                >
                  <i class="fas fa-download mr-2"></i>Exportar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros: <span id="export-count-nrs">0</span>
                </p>
              </div>

              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-green-700">
                  <i class="fas fa-graduation-cap mr-2"></i>Treinamentos
                </h3>
                <button
                  onclick="exportarTabela('treinamentos')"
                  class="btn btn-success w-full"
                >
                  <i class="fas fa-download mr-2"></i>Exportar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros: <span id="export-count-treinamentos">0</span>
                </p>
              </div>

              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-green-700">
                  <i class="fas fa-chalkboard-teacher mr-2"></i>Instrutores
                </h3>
                <button
                  onclick="exportarTabela('instrutores')"
                  class="btn btn-success w-full"
                >
                  <i class="fas fa-download mr-2"></i>Exportar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros: <span id="export-count-instrutores">0</span>
                </p>
              </div>

              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-green-700">
                  <i class="fas fa-handshake mr-2"></i>Clientes
                </h3>
                <button
                  onclick="exportarTabela('clientes')"
                  class="btn btn-success w-full"
                >
                  <i class="fas fa-download mr-2"></i>Exportar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros: <span id="export-count-clientes">0</span>
                </p>
              </div>

              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-green-700">
                  <i class="fas fa-building mr-2"></i>Projetos
                </h3>
                <button
                  onclick="exportarTabela('projetos')"
                  class="btn btn-success w-full"
                >
                  <i class="fas fa-download mr-2"></i>Exportar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros: <span id="export-count-projetos">0</span>
                </p>
              </div>

              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-green-700">
                  <i class="fas fa-users-cog mr-2"></i>Turmas
                </h3>
                <button
                  onclick="exportarTabela('turmas')"
                  class="btn btn-success w-full"
                >
                  <i class="fas fa-download mr-2"></i>Exportar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros: <span id="export-count-turmas">0</span>
                </p>
              </div>

              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-green-700">
                  <i class="fas fa-clock mr-2"></i>Hor√°rios
                </h3>
                <button
                  onclick="exportarTabela('horarios')"
                  class="btn btn-success w-full"
                >
                  <i class="fas fa-download mr-2"></i>Exportar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros: <span id="export-count-horarios">0</span>
                </p>
              </div>

              <div
                class="border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <h3 class="font-semibold mb-3 text-green-700">
                  <i class="fas fa-history mr-2"></i>Hist√≥rico Treinamentos
                </h3>
                <button
                  onclick="exportarTabela('historicoTreinamentos')"
                  class="btn btn-success w-full"
                >
                  <i class="fas fa-download mr-2"></i>Exportar
                </button>
                <p class="text-xs text-gray-500 mt-2">
                  Registros: <span id="export-count-historico">0</span>
                </p>
              </div>
            </div>

            <div class="mt-8 p-4 bg-gray-100 rounded-lg">
              <h3 class="font-semibold mb-3">Exportar Tudo</h3>
              <button onclick="exportarTodasTabelas()" class="btn btn-primary">
                <i class="fas fa-download mr-2"></i>Exportar Todas as Tabelas
                (ZIP simulado)
              </button>
              <p class="text-xs text-gray-500 mt-2">
                Exporta todas as tabelas em arquivos JSON separados
              </p>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Modal -->
    <div id="modal-backdrop" class="modal-backdrop"></div>
    <div id="modal" class="modal">
      <div class="p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 id="modal-title" class="text-xl font-semibold">T√≠tulo</h3>
          <button id="modal-close" class="text-gray-500 hover:text-gray-800">
            <i class="fas fa-times fa-lg"></i>
          </button>
        </div>
        <div id="modal-body"></div>
      </div>
    </div>

    <div id="certificado-modal" class="modal modal-lg">
      <div class="p-4 bg-white rounded-lg shadow-xl">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-2xl font-bold">Certificado</h3>
          <div class="flex gap-2">
            <button id="imprimir-certificado-btn" class="btn btn-secondary">
              <i class="fas fa-print mr-2"></i>Imprimir
            </button>
            <button
              id="fechar-certificado-btn"
              class="text-gray-500 hover:text-gray-800"
            >
              <i class="fas fa-times fa-lg"></i>
            </button>
          </div>
        </div>
        <div id="certificado-content" class="w-full overflow-auto"></div>
      </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast">
      <span id="toast-message"></span>
    </div>

    <!-- Inputs ocultos para upload -->
    <input type="file" id="file-input" class="hidden" accept=".json" />
    <input type="file" id="file-input-csv" class="hidden" accept=".csv" />
    <input type="file" id="file-input-backup" class="hidden" accept=".json" />

    <script>
      // === SISTEMA INTEGRADO PROSSEN ===
      // Unifica√ß√£o dos sistemas de RH e Controle de Ponto

      document.addEventListener("DOMContentLoaded", () => {
        // --- BANCO DE DADOS UNIFICADO ---
        let db = {
          funcionarios: [],
          cargos: [],
          nrs: [],
          treinamentos: [],
          instrutores: [],
          clientes: [],
          projetos: [],
          turmas: [],
          horarios: [],
          rdoProjetos: [],
          rdoLancamentos: [],
          backupHistory: [],
          historicoTreinamentos: [],
        };

        let proximaMatricula = 1;
        let modoEdicao = false;
        let itemEmEdicao = null;

        // --- CHAVE DE ARMAZENAMENTO ---
        const STORAGE_KEY = "prossenIntegradoDB";

        // --- FUN√á√ïES UTILIT√ÅRIAS ---
        const getNextId = (collection) =>
          Math.max(0, ...collection.map((item) => item.id || 0)) + 1;
        const getNextNumero = (collection) =>
          Math.max(0, ...collection.map((item) => item.numero || 0)) + 1;

        const showToast = (message, isError = false) => {
          const toast = document.getElementById("toast");
          const toastMessage = document.getElementById("toast-message");

          toastMessage.textContent = message;
          toast.className = `toast ${isError ? "error" : "success"} show`;

          setTimeout(() => {
            toast.classList.remove("show");
          }, 4000);
        };

        const formatarData = (data) => {
          if (!data) return "";
          const [ano, mes, dia] = data.split("-");
          return `${dia}/${mes}/${ano}`;
        };

        const formatarDataExtenso = (data) => {
          if (!data) return "";
          const date = new Date(data + "T00:00:00");
          const options = { year: "numeric", month: "long", day: "numeric" };
          return date.toLocaleDateString("pt-BR", options);
        };

        const adicionarMeses = (data, meses) => {
          const [ano, mes, dia] = data.split("-").map(Number);
          const date = new Date(ano, mes - 1 + meses, dia);
          return date.toISOString().split("T")[0];
        };

        // --- PERSIST√äNCIA DE DADOS ---
        const saveDB = () => {
          try {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
            console.log("Database saved successfully");
          } catch (error) {
            console.error("Error saving to localStorage:", error);
            showToast("Erro ao salvar dados", true);
          }
        };

        const loadDB = () => {
          try {
            const savedDB = localStorage.getItem(STORAGE_KEY);
            if (savedDB) {
              const loadedData = JSON.parse(savedDB);

              // Migra√ß√£o/compatibilidade com dados antigos
              db = {
                funcionarios:
                  loadedData.funcionarios || loadedData.pessoas || [],
                cargos: loadedData.cargos || loadedData.funcoes || [],
                nrs: loadedData.nrs || [],
                treinamentos: loadedData.treinamentos || [],
                instrutores: loadedData.instrutores || [],
                clientes: loadedData.clientes || [],
                projetos: loadedData.projetos || [],
                turmas: loadedData.turmas || [],
                horarios: loadedData.horarios || [],
                rdoProjetos: loadedData.rdoProjetos || [],
                rdoLancamentos: loadedData.rdoLancamentos || [],
                backupHistory: loadedData.backupHistory || [],
                historicoTreinamentos: loadedData.historicoTreinamentos || [],
              };

              // Normalizar dados de funcion√°rios
              db.funcionarios.forEach((funcionario) => {
                if (!funcionario.status) funcionario.status = "ativo";
                if (!funcionario.classificacao)
                  funcionario.classificacao = "Direto";
                if (!funcionario.matricula && funcionario.id) {
                  funcionario.matricula = String(funcionario.id).padStart(
                    4,
                    "0"
                  );
                }
              });

              proximaMatricula =
                Math.max(
                  1,
                  ...db.funcionarios.map((f) => parseInt(f.matricula) || 0)
                ) + 1;

              console.log("Database loaded successfully");
              showToast("Dados carregados com sucesso");
            } else {
              // Dados iniciais de exemplo
              db = {
                funcionarios: [
                  {
                    matricula: "0001",
                    nome: "Jo√£o",
                    sobrenome: "Silva",
                    cpf: "111.222.333-44",
                    cargo: "Eletricista",
                    classificacao: "Direto",
                    status: "ativo",
                    telefone: "(11) 99999-9999",
                    email: "joao.silva@example.com",
                  },
                  {
                    matricula: "0002",
                    nome: "Maria",
                    sobrenome: "Santos",
                    cpf: "555.666.777-88",
                    cargo: "Engenheira Civil",
                    classificacao: "Direto",
                    status: "ativo",
                    telefone: "(11) 88888-8888",
                    email: "maria.santos@example.com",
                  },
                ],
                cargos: [
                  { id: 1, nome: "Eletricista" },
                  { id: 2, nome: "Engenheira Civil" },
                  { id: 3, nome: "Pedreiro" },
                  { id: 4, nome: "Soldador" },
                ],
                nrs: [
                  {
                    id: 1,
                    codigo: "NR-10",
                    descricao:
                      "Seguran√ßa em Instala√ß√µes e Servi√ßos em Eletricidade",
                    cargaHoraria: 40,
                    validade: 12,
                    objetivo:
                      "Capacitar profissionais para trabalhos seguros com eletricidade",
                    frequencia: 100,
                    conteudoProgramatico:
                      "Introdu√ß√£o √† NR-10; Medidas de controle do risco el√©trico; Equipamentos de prote√ß√£o coletiva e individual.",
                  },
                  {
                    id: 2,
                    codigo: "NR-35",
                    descricao: "Trabalho em Altura",
                    cargaHoraria: 8,
                    validade: 24,
                    objetivo:
                      "Garantir a seguran√ßa em trabalhos realizados em altura",
                    frequencia: 100,
                    conteudoProgramatico:
                      "Normas e regulamentos aplic√°veis ao trabalho em altura; An√°lise de risco; Sistemas de ancoragem e equipamentos de prote√ß√£o individual.",
                  },
                ],
                treinamentos: [
                  {
                    id: 1,
                    codigo: "TE-01",
                    descricao: "Opera√ß√£o de Grua",
                    cargaHoraria: 16,
                    validade: 12,
                    objetivo:
                      "Capacitar operadores de equipamentos de eleva√ß√£o",
                    frequencia: 100,
                    conteudoProgramatico:
                      "Introdu√ß√£o √† opera√ß√£o de grua; Componentes e tipos de gruas; Procedimentos de seguran√ßa e opera√ß√£o.",
                  },
                ],
                instrutores: [
                  {
                    id: 1,
                    nome: "Carlos Instrutor",
                    cpf: "999.888.777-66",
                    habilitacao: "CREA/SP 123456",
                  },
                ],
                clientes: [
                  {
                    id: 1,
                    nome: "Construtora Alfa",
                    cidade: "S√£o Paulo",
                    estado: "SP",
                  },
                ],
                projetos: [
                  {
                    id: 1,
                    numero: 10001,
                    descricao: "Edif√≠cio Residencial Sol",
                    clienteId: 1,
                  },
                  {
                    id: 2,
                    numero: 10002,
                    descricao: "Shopping Center Norte",
                    clienteId: 1,
                  },
                ],
                turmas: [
                  {
                    id: 1,
                    codinome: "El√©trica-A",
                    descricao: "Equipe de instala√ß√µes el√©tricas",
                    horarioEntrada: "07:30",
                    horarioSaida: "17:30",
                    membros: ["0001"],
                  },
                  {
                    id: 2,
                    codinome: "Civil-B",
                    descricao: "Equipe de obras civis",
                    horarioEntrada: "08:00",
                    horarioSaida: "18:00",
                    membros: ["0002"],
                  },
                ],
                horarios: [
                  {
                    id: 1,
                    data: "2025-01-20",
                    turmaId: 1,
                    projetoId: 1,
                    funcionarioMatricula: "0001",
                    horaEntrada: "07:30",
                    horaSaida: "17:30",
                    horasTrabalhadas: 9.0,
                  },
                  {
                    id: 2,
                    data: "2025-01-21",
                    turmaId: 2,
                    projetoId: 2,
                    funcionarioMatricula: "0002",
                    horaEntrada: "08:00",
                    horaSaida: "18:00",
                    horasTrabalhadas: 9.0,
                  },
                ],
                rdoProjetos: [],
                rdoLancamentos: [],
                backupHistory: [],
                historicoTreinamentos: [],
              };
              proximaMatricula = 3;
              showToast("Sistema inicializado com dados de exemplo");
            }
          } catch (error) {
            console.error("Error loading database:", error);
            showToast("Erro ao carregar dados", true);
          }

          renderAll();
          atualizarDisplayMatricula();
        };

        // --- BACKUP E RESTAURA√á√ÉO ---
        const exportDB = () => {
          const dataStr = JSON.stringify(db, null, 2);
          const dataBlob = new Blob([dataStr], { type: "application/json" });
          const url = URL.createObjectURL(dataBlob);
          const link = document.createElement("a");
          const date = new Date().toISOString().slice(0, 10);
          link.download = `backup_prossen_${date}.json`;
          link.href = url;
          link.click();
          URL.revokeObjectURL(url);
          showToast("Backup exportado com sucesso!");
        };

        const importDB = () => {
          const fileInput = document.getElementById("file-input-backup");
          fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (event) => {
                try {
                  const importedData = JSON.parse(event.target.result);
                  if (
                    confirm(
                      "Isso substituir√° todos os dados atuais. Deseja continuar?"
                    )
                  ) {
                    db = importedData;
                    proximaMatricula =
                      Math.max(
                        1,
                        ...db.funcionarios.map(
                          (f) => parseInt(f.matricula) || 0
                        )
                      ) + 1;
                    saveDB();
                    renderAll();
                    showToast("Dados importados com sucesso!");
                    switchView("funcionarios");
                  }
                } catch (error) {
                  showToast("Arquivo de backup inv√°lido", true);
                }
              };
              reader.readAsText(file);
            }
            fileInput.value = "";
          };
          fileInput.click();
        };

        const resetDB = () => {
          if (
            confirm(
              "ATEN√á√ÉO! Esta a√ß√£o apagar√° TODOS os dados permanentemente. Deseja continuar?"
            )
          ) {
            if (
              confirm("Esta a√ß√£o √© IRREVERS√çVEL. Confirma o reset completo?")
            ) {
              localStorage.removeItem(STORAGE_KEY);
              location.reload();
            }
          }
        };

        // --- RELAT√ìRIOS DE PONTO ---
        const renderRelatoriosPontoSelects = () => {
          const selectFuncionario =
            document.getElementById("filtro-funcionario");
          if (selectFuncionario) {
            const funcionariosAtivos = db.funcionarios.filter(
              (f) => f.status === "ativo"
            );
            selectFuncionario.innerHTML =
              '<option value="">Todos os funcion√°rios</option>' +
              funcionariosAtivos
                .sort((a, b) =>
                  `${a.nome} ${a.sobrenome}`.localeCompare(
                    `${b.nome} ${b.sobrenome}`
                  )
                )
                .map((f) => {
                  const fullName = `${f.nome || ""} ${
                    f.sobrenome || ""
                  }`.trim();
                  return `<option value="${f.matricula}">${fullName} (${f.matricula})</option>`;
                })
                .join("");
          }

          const selectTurma = document.getElementById("filtro-turma-relatorio");
          if (selectTurma) {
            selectTurma.innerHTML =
              '<option value="">Todas as turmas</option>' +
              db.turmas
                .map((t) => `<option value="${t.id}">${t.codinome}</option>`)
                .join("");
          }

          const selectProjeto = document.getElementById(
            "filtro-projeto-relatorio"
          );
          if (selectProjeto) {
            selectProjeto.innerHTML =
              '<option value="">Todos os projetos</option>' +
              db.projetos
                .map(
                  (p) =>
                    `<option value="${p.id}">${p.numero} - ${p.descricao}</option>`
                )
                .join("");
          }
        };

        const aplicarFiltrosRelatorio = () => {
          const filtros = {
            dataInicio: document.getElementById("filtro-data-inicio").value,
            dataFim: document.getElementById("filtro-data-fim").value,
            funcionario: document.getElementById("filtro-funcionario").value,
            turma: document.getElementById("filtro-turma-relatorio").value,
            projeto: document.getElementById("filtro-projeto-relatorio").value,
          };

          let dadosFiltrados = db.horarios.filter((h) => {
            let incluir = true;

            if (filtros.dataInicio && h.data < filtros.dataInicio) {
              incluir = false;
            }
            if (filtros.dataFim && h.data > filtros.dataFim) {
              incluir = false;
            }

            if (
              filtros.funcionario &&
              h.funcionarioMatricula !== filtros.funcionario
            ) {
              incluir = false;
            }

            if (filtros.turma && h.turmaId != parseInt(filtros.turma)) {
              incluir = false;
            }

            if (filtros.projeto && h.projetoId != parseInt(filtros.projeto)) {
              incluir = false;
            }

            return incluir;
          });

          dadosFiltrados.sort((a, b) => new Date(b.data) - new Date(a.data));

          renderTabelaRelatorio(dadosFiltrados);
        };

        const renderTabelaRelatorio = (dados) => {
          const tbody = document.getElementById("relatorio-ponto-tbody");
          const totalRegistros = document.getElementById("total-registros");
          const totalHoras = document.getElementById("total-horas");
          const exportBtn = document.getElementById(
            "exportar-csv-relatorio-btn"
          );

          if (dados.length === 0) {
            tbody.innerHTML = `
                        <tr>
                            <td colspan="8" class="p-8 text-center text-gray-500">
                                Nenhum registro encontrado para os filtros aplicados
                            </td>
                        </tr>
                    `;
            totalRegistros.textContent = "Nenhum registro encontrado";
            totalHoras.textContent = "";
            exportBtn.style.display = "none";
            return;
          }

          const somaHoras = dados.reduce(
            (acc, h) => acc + (h.horasTrabalhadas || 0),
            0
          );

          tbody.innerHTML = dados
            .map((h) => {
              const funcionario = db.funcionarios.find(
                (f) => f.matricula === h.funcionarioMatricula
              );
              const turma = db.turmas.find((t) => t.id === h.turmaId);
              const projeto = db.projetos.find((p) => p.id === h.projetoId);

              const nomeFuncionario = funcionario
                ? `${funcionario.nome || ""} ${
                    funcionario.sobrenome || ""
                  }`.trim()
                : `Matr√≠cula: ${h.funcionarioMatricula}`;
              const nomeTurma = turma ? turma.codinome : "N/A";
              const nomeProjeto = projeto
                ? `${projeto.numero} - ${projeto.descricao}`
                : "N/A";

              const dataFormatada = new Date(
                h.data + "T00:00:00"
              ).toLocaleDateString("pt-BR");

              return `
                        <tr class="hover:bg-gray-50 border-b">
                            <td class="p-3">${dataFormatada}</td>
                            <td class="p-3">${nomeFuncionario}</td>
                            <td class="p-3">${nomeTurma}</td>
                            <td class="p-3">${nomeProjeto}</td>
                            <td class="p-3">${h.horaEntrada}</td>
                            <td class="p-3">${h.horaSaida}</td>
                            <td class="p-3 text-right font-semibold">${(
                              h.horasTrabalhadas || 0
                            ).toFixed(2)}h</td>
                            <td class="p-3 text-center">
                                <button class="action-btn edit-btn mr-1" onclick="editarRegistroPonto(${
                                  h.id
                                })" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deletarRegistroPonto(${
                                  h.id
                                })" title="Excluir">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
            })
            .join("");

          totalRegistros.textContent = `${dados.length} registro(s) encontrado(s)`;
          totalHoras.textContent = `Total: ${somaHoras.toFixed(2)} horas`;
          exportBtn.style.display = "inline-block";

          exportBtn.dataset.dadosRelatorio = JSON.stringify(dados);
        };

        const limparFiltrosRelatorio = () => {
          document.getElementById("filtro-data-inicio").value = "";
          document.getElementById("filtro-data-fim").value = "";
          document.getElementById("filtro-funcionario").value = "";
          document.getElementById("filtro-turma-relatorio").value = "";
          document.getElementById("filtro-projeto-relatorio").value = "";

          document.getElementById("relatorio-ponto-tbody").innerHTML = `
                    <tr>
                        <td colspan="8" class="p-8 text-center text-gray-500">
                            Use os filtros acima para gerar um relat√≥rio de ponto
                        </td>
                    </tr>
                `;
          document.getElementById("total-registros").textContent =
            "Nenhum registro encontrado";
          document.getElementById("total-horas").textContent = "";
          document.getElementById("exportar-csv-relatorio-btn").style.display =
            "none";
        };

        // --- NAVEGA√á√ÉO ENTRE VIEWS ---
        const switchView = (viewId) => {
          document
            .querySelectorAll(".view")
            .forEach((view) => view.classList.remove("active"));

          const targetView = document.getElementById(`${viewId}-view`);
          if (targetView) {
            targetView.classList.add("active");

            document
              .querySelectorAll(".nav-link-sub")
              .forEach((link) => link.classList.remove("active"));
            const activeLink = document.querySelector(
              `.nav-link-sub[data-view="${viewId}"]`
            );
            if (activeLink) {
              activeLink.classList.add("active");
            }

            switch (viewId) {
              case "funcionarios":
                renderCargosDatalist();
                renderMaesDatalist();
                break;
              case "lancamento-horas":
                renderTurmasSelect();
                renderProjetosSelect();
                setTodayDate();
                break;
              case "projetos":
                renderClientesSelect();
                break;
              case "relatorios-ponto":
                renderRelatoriosPontoSelects();
                break;
              case "certificados":
                renderCertificadoSelects();
                break;
              case "historico-treinamentos":
                renderHistoricoTreinamentosTable();
                break;
              case "importacao":
              case "exportacao":
                atualizarContagemRegistros();
                break;
            }
          }
        };

        document.querySelectorAll(".nav-link-sub").forEach((link) => {
          link.addEventListener("click", (e) => {
            e.preventDefault();
            switchView(
              e.target.dataset.view || e.target.closest("a").dataset.view
            );
          });
        });

        // --- MODAL SYSTEM ---
        const openModal = (title, bodyHtml) => {
          document.getElementById("modal-title").textContent = title;
          document.getElementById("modal-body").innerHTML = bodyHtml;
          document.getElementById("modal-backdrop").style.display = "block";
          document.getElementById("modal").style.display = "block";
        };

        const closeModal = () => {
          document.getElementById("modal-backdrop").style.display = "none";
          document.getElementById("modal").style.display = "none";
          document.getElementById("modal-body").innerHTML = "";
        };

        document
          .getElementById("modal-close")
          .addEventListener("click", closeModal);
        document
          .getElementById("modal-backdrop")
          .addEventListener("click", closeModal);

        const openCertificadoModal = (htmlContent) => {
          document.getElementById("certificado-content").innerHTML =
            htmlContent;
          document.getElementById("modal-backdrop").style.display = "block";
          document.getElementById("certificado-modal").style.display = "block";
        };

        const closeCertificadoModal = () => {
          document.getElementById("modal-backdrop").style.display = "none";
          document.getElementById("certificado-modal").style.display = "none";
          document.getElementById("certificado-content").innerHTML = "";
        };

        document
          .getElementById("fechar-certificado-btn")
          .addEventListener("click", closeCertificadoModal);
        document
          .getElementById("imprimir-certificado-btn")
          .addEventListener("click", () => {
            const nomeDocumento = document
              .getElementById("imprimir-certificado-btn")
              .getAttribute("data-filename");

            if (nomeDocumento) {
              // Salvar t√≠tulo original
              const tituloOriginal = document.title;

              // Alterar t√≠tulo temporariamente para o nome do documento
              document.title = nomeDocumento;

              // Chamar impress√£o
              window.print();

              // Restaurar t√≠tulo original ap√≥s impress√£o ou cancelamento
              // Usa evento afterprint (funciona na maioria dos navegadores)
              window.onafterprint = function () {
                document.title = tituloOriginal;
                window.onafterprint = null;
              };

              // Fallback: restaurar ap√≥s 2 segundos caso o evento n√£o funcione
              setTimeout(() => {
                if (document.title !== tituloOriginal) {
                  document.title = tituloOriginal;
                }
              }, 2000);
            } else {
              window.print();
            }
          });

        // --- APLICAR M√ÅSCARAS ---
        const aplicarMascaras = () => {
          const cpfInputs = document.querySelectorAll(
            "#cpf, #instrutor-cpf, #filter-cpf, #cpf_conjuge, #cpf_filho1, #cpf_filho2, #cpf_filho3"
          );
          cpfInputs.forEach((input) => {
            if (input) IMask(input, { mask: "000.000.000-00" });
          });

          const telefoneInputs = document.querySelectorAll("#telefone");
          telefoneInputs.forEach((input) => {
            if (input) IMask(input, { mask: "(00) 00000-0000" });
          });

          const dateInputs = document.querySelectorAll(
            "#data_nascimento, #data_admissao, #data_emissao, #nascimento_conjuge, #nascimento_filho1, #nascimento_filho2, #nascimento_filho3"
          );
          dateInputs.forEach((input) => {
            if (input) IMask(input, { mask: "00/00/0000" });
          });

          const cepInput = document.getElementById("cep");
          if (cepInput) IMask(cepInput, { mask: "00000-000" });

          const pisInput = document.getElementById("pis");
          if (pisInput) IMask(pisInput, { mask: "000.00000.00-0" });

          const cboInput = document.getElementById("cbo");
          if (cboInput) IMask(cboInput, { mask: "0000-00" });

          const moneyInputs = document.querySelectorAll(
            "#salario, #valor_hora, #vale_alimentacao, #cesta_basica"
          );
          moneyInputs.forEach((input) => {
            if (input)
              IMask(input, {
                mask: "R$ num",
                blocks: {
                  num: {
                    mask: Number,
                    scale: 2,
                    thousandsSeparator: ".",
                    padFractionalZeros: true,
                    radix: ",",
                  },
                },
              });
          });
        };

        // --- L√ìGICA DO TIPO DE CONTRATO ---
        const tipoContratoSelect = document.getElementById("tipo_contrato");
        const salarioInput = document.getElementById("salario");
        const valorHoraInput = document.getElementById("valor_hora");

        if (tipoContratoSelect && salarioInput && valorHoraInput) {
          tipoContratoSelect.addEventListener("change", function () {
            const tipo = this.value;
            salarioInput.readOnly = true;
            valorHoraInput.readOnly = true;

            if (!modoEdicao) {
              salarioInput.value = "";
              valorHoraInput.value = "";
            }

            if (tipo === "fixo") {
              salarioInput.readOnly = false;
            } else if (tipo === "intermitente") {
              valorHoraInput.readOnly = false;
            }
          });
        }

        // --- C√ÅLCULO DE IDADE ---
        document
          .getElementById("data_nascimento")
          .addEventListener("blur", function () {
            const dateString = this.value;
            const idadeInput = document.getElementById("idade");

            if (dateString.length === 10) {
              const [dia, mes, ano] = dateString.split("/");
              const birthDate = new Date(+ano, +mes - 1, +dia);

              if (!isNaN(birthDate.getTime())) {
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();

                if (
                  monthDiff < 0 ||
                  (monthDiff === 0 && today.getDate() < birthDate.getDate())
                ) {
                  age--;
                }

                idadeInput.value = age >= 0 ? age : "";
              } else {
                idadeInput.value = "";
              }
            } else {
              idadeInput.value = "";
            }
          });

        // --- FUN√á√ïES DE RENDERIZA√á√ÉO ---
        const atualizarDisplayMatricula = () => {
          const matriculaInput = document.getElementById("matricula");
          if (matriculaInput) {
            matriculaInput.value = String(proximaMatricula).padStart(4, "0");
          }
        };

        const renderEmployeeTable = (filteredData = db.funcionarios) => {
          const tbody = document
            .getElementById("employee-table")
            .querySelector("tbody");
          tbody.innerHTML = filteredData
            .map((funcionario) => {
              const fullName = `${funcionario.nome || ""} ${
                funcionario.sobrenome || ""
              }`.trim();
              const statusBadge =
                funcionario.status === "ativo"
                  ? '<span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full">Ativo</span>'
                  : '<span class="bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded-full">Inativo</span>';

              return `
                        <tr class="hover:bg-gray-50">
                            <td class="p-3">${funcionario.matricula || ""}</td>
                            <td class="p-3">${fullName}</td>
                            <td class="p-3">${funcionario.cpf || ""}</td>
                            <td class="p-3">${funcionario.cargo || ""}</td>
                            <td class="p-3">${statusBadge}</td>
                            <td class="p-3">
                                <button class="action-btn edit-btn" onclick="editEmployee('${
                                  funcionario.matricula
                                }')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteEmployee('${
                                  funcionario.matricula
                                }')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
            })
            .join("");
        };

        const renderCargosTable = () => {
          const tbody = document
            .getElementById("cargos-table")
            .querySelector("tbody");
          tbody.innerHTML = db.cargos
            .map(
              (cargo) => `
                    <tr class="hover:bg-gray-50">
                        <td class="p-3">${cargo.nome}</td>
                        <td class="p-3">
                            <button class="action-btn edit-btn" onclick="editCargo(${cargo.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteCargo(${cargo.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `
            )
            .join("");
        };

        const renderCargosDatalist = () => {
          const datalist = document.getElementById("cargos-lista");
          if (datalist) {
            datalist.innerHTML = db.cargos
              .map((cargo) => `<option value="${cargo.nome}"></option>`)
              .join("");
          }
        };

        const renderMaesDatalist = () => {
          const datalist = document.getElementById("maes-lista");
          if (datalist) {
            const uniqueMothers = [
              ...new Set(
                db.funcionarios.map((f) => f.nome_mae).filter(Boolean)
              ),
            ];
            datalist.innerHTML = uniqueMothers
              .map((mae) => `<option value="${mae}"></option>`)
              .join("");
          }
        };

        const renderNrsTable = () => {
          const tbody = document
            .getElementById("nrs-table")
            .querySelector("tbody");
          tbody.innerHTML = db.nrs
            .map(
              (nr) => `
                    <tr class="hover:bg-gray-50">
                        <td class="p-3">${nr.codigo}</td>
                        <td class="p-3">${nr.descricao}</td>
                        <td class="p-3">${nr.cargaHoraria}h</td>
                        <td class="p-3">${nr.validade} meses</td>
                        <td class="p-3">
                            <button class="action-btn edit-btn" onclick="editNr(${nr.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteNr(${nr.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `
            )
            .join("");
        };

        const renderTreinamentosTable = () => {
          const tbody = document
            .getElementById("treinamentos-table")
            .querySelector("tbody");
          tbody.innerHTML = db.treinamentos
            .map(
              (treinamento) => `
                    <tr class="hover:bg-gray-50">
                        <td class="p-3">${treinamento.codigo}</td>
                        <td class="p-3">${treinamento.descricao}</td>
                        <td class="p-3">${treinamento.cargaHoraria}h</td>
                        <td class="p-3">${treinamento.validade} meses</td>
                        <td class="p-3">
                            <button class="action-btn edit-btn" onclick="editTreinamento(${treinamento.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteTreinamento(${treinamento.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `
            )
            .join("");
        };

        const renderInstrutoresTable = () => {
          const tbody = document
            .getElementById("instrutores-table")
            .querySelector("tbody");
          tbody.innerHTML = db.instrutores
            .map(
              (instrutor) => `
                    <tr class="hover:bg-gray-50">
                        <td class="p-3">${instrutor.nome}</td>
                        <td class="p-3">${instrutor.cpf}</td>
                        <td class="p-3">${instrutor.habilitacao}</td>
                        <td class="p-3">
                            <button class="action-btn edit-btn" onclick="editInstrutor(${instrutor.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteInstrutor(${instrutor.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `
            )
            .join("");
        };

        const renderClientesTable = () => {
          const tbody = document
            .getElementById("clientes-table")
            .querySelector("tbody");
          tbody.innerHTML = db.clientes
            .map(
              (cliente) => `
                    <tr class="hover:bg-gray-50">
                        <td class="p-3">${cliente.nome}</td>
                        <td class="p-3">${cliente.cidade || ""}</td>
                        <td class="p-3">${cliente.estado || ""}</td>
                        <td class="p-3">
                            <button class="action-btn edit-btn" onclick="editCliente(${
                              cliente.id
                            })">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteCliente(${
                              cliente.id
                            })">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `
            )
            .join("");
        };

        const renderProjetosTable = () => {
          const tbody = document
            .getElementById("projetos-table")
            .querySelector("tbody");
          tbody.innerHTML =
            db.projetos.length > 0
              ? db.projetos
                  .map((projeto) => {
                    const cliente = db.clientes.find(
                      (c) => c.id === projeto.clienteId
                    );
                    return `
                            <tr class="hover:bg-gray-50">
                                <td class="p-3">${projeto.numero}</td>
                                <td class="p-3">${projeto.descricao}</td>
                                <td class="p-3">${
                                  cliente ? cliente.nome : "N/A"
                                }</td>
                                <td class="p-3">
                                    <button class="action-btn edit-btn" onclick="editProjeto(${
                                      projeto.id
                                    })">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn delete-btn" onclick="deleteProjeto(${
                                      projeto.id
                                    })">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                  })
                  .join("")
              : `<tr><td colspan="4" class="text-center">Nenhum projeto cadastrado.</td></tr>`;
        };

        const renderTurmasTable = () => {
          const tbody = document
            .getElementById("turmas-table")
            .querySelector("tbody");
          tbody.innerHTML =
            db.turmas.length > 0
              ? db.turmas
                  .map(
                    (turma) => `
                        <tr class="hover:bg-gray-50">
                            <td class="p-3">${turma.codinome}</td>
                            <td class="p-3">${turma.descricao || ""}</td>
                            <td class="p-3">${turma.horarioEntrada} - ${
                      turma.horarioSaida
                    }</td>
                            <td class="p-3">${(turma.membros || []).length}</td>
                            <td class="p-3">
                                <button class="action-btn" style="background-color: #17a2b8;" onclick="gerenciarMembros(${
                                  turma.id
                                })">
                                    <i class="fas fa-users"></i> Membros
                                </button>
                                <button class="action-btn edit-btn" onclick="editTurma(${
                                  turma.id
                                })">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteTurma(${
                                  turma.id
                                })">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `
                  )
                  .join("")
              : `<tr><td colspan="5" class="text-center">Nenhuma turma cadastrada.</td></tr>`;
        };

        const renderTurmasSelect = () => {
          const select = document.getElementById("lancamento-turma");
          if (select) {
            select.innerHTML =
              '<option value="">Selecione uma turma</option>' +
              db.turmas
                .map(
                  (turma) =>
                    `<option value="${turma.id}">${turma.codinome}</option>`
                )
                .join("");
          }
        };

        const renderProjetosSelect = () => {
          const select = document.getElementById("lancamento-projeto");
          if (select) {
            select.innerHTML =
              '<option value="">Selecione um projeto</option>' +
              db.projetos
                .map(
                  (projeto) =>
                    `<option value="${projeto.id}">${projeto.numero} - ${projeto.descricao}</option>`
                )
                .join("");
          }
        };

        const renderClientesSelect = () => {
          const select = document.getElementById("projeto-cliente");
          if (select) {
            select.innerHTML =
              '<option value="">Selecione um cliente</option>' +
              db.clientes
                .map(
                  (cliente) =>
                    `<option value="${cliente.id}">${cliente.nome}</option>`
                )
                .join("");
          }
        };

        const renderCertificadoSelects = () => {
          const selectFuncionario = document.getElementById(
            "certificado-funcionario"
          );
          const selectTreinamentoTipo = document.getElementById(
            "certificado-treinamento-tipo"
          );
          const selectTreinamento = document.getElementById(
            "certificado-treinamento"
          );
          const selectInstrutor = document.getElementById(
            "certificado-instrutor"
          );

          selectFuncionario.innerHTML =
            '<option value="">Selecione um funcion√°rio</option>' +
            db.funcionarios
              .map(
                (f) =>
                  `<option value="${f.matricula}">${f.nome} ${f.sobrenome} (${f.cpf})</option>`
              )
              .join("");

          selectInstrutor.innerHTML =
            '<option value="">Selecione um instrutor</option>' +
            db.instrutores
              .map(
                (i) =>
                  `<option value="${i.id}">${i.nome} (${i.habilitacao})</option>`
              )
              .join("");

          selectTreinamentoTipo.addEventListener("change", () => {
            const tipo = selectTreinamentoTipo.value;
            let options = '<option value="">Selecione um treinamento</option>';
            if (tipo === "nr") {
              options += db.nrs
                .map(
                  (n) =>
                    `<option value="${n.id}">${n.codigo} - ${n.descricao}</option>`
                )
                .join("");
            } else if (tipo === "te") {
              options += db.treinamentos
                .map(
                  (t) =>
                    `<option value="${t.id}">${t.codigo} - ${t.descricao}</option>`
                )
                .join("");
            }
            selectTreinamento.innerHTML = options;
            selectTreinamento.disabled = !tipo;
          });
        };

        const renderHistoricoTreinamentosTable = () => {
          const tbody = document
            .getElementById("historico-treinamentos-table")
            .querySelector("tbody");
          const filtroVencimento =
            document.getElementById("filtro-vencimento").value;
          const filtroNome = document
            .getElementById("filtro-historico")
            .value.toLowerCase();
          const today = new Date();

          const filteredData = db.historicoTreinamentos.filter((h) => {
            const funcionario = db.funcionarios.find(
              (f) => f.matricula === h.matriculaFuncionario
            );
            if (
              filtroNome &&
              (!funcionario ||
                `${funcionario.nome} ${funcionario.sobrenome}`
                  .toLowerCase()
                  .indexOf(filtroNome) === -1)
            ) {
              return false;
            }

            const dataValidade = new Date(h.dataValidade + "T00:00:00");
            const diffMonths =
              (dataValidade.getFullYear() - today.getFullYear()) * 12 +
              (dataValidade.getMonth() - today.getMonth());

            if (
              filtroVencimento === "vencendo" &&
              (diffMonths < 0 || diffMonths > 3)
            ) {
              return false;
            }
            if (filtroVencimento === "vencidos" && diffMonths >= 0) {
              return false;
            }
            return true;
          });

          tbody.innerHTML = filteredData
            .map((h) => {
              const funcionario = db.funcionarios.find(
                (f) => f.matricula === h.matriculaFuncionario
              );
              let treinamento = null;
              if (h.tipoTreinamento === "nr") {
                treinamento = db.nrs.find((n) => n.id === h.idTreinamento);
              } else {
                treinamento = db.treinamentos.find(
                  (t) => t.id === h.idTreinamento
                );
              }
              const instrutor = db.instrutores.find(
                (i) => i.id === h.idInstrutor
              );

              let statusBadge = "";
              const dataValidade = new Date(h.dataValidade + "T00:00:00");
              const diffDays = Math.ceil(
                (dataValidade - today) / (1000 * 60 * 60 * 24)
              );

              if (diffDays <= 0) {
                statusBadge = `<span class="bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded-full">Vencido</span>`;
              } else if (diffDays <= 90) {
                statusBadge = `<span class="bg-yellow-100 text-yellow-800 text-xs font-medium px-2.5 py-0.5 rounded-full">A Vencer</span>`;
              } else {
                statusBadge = `<span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full">V√°lido</span>`;
              }

              return `
                        <tr class="hover:bg-gray-50">
                            <td class="p-3">${
                              funcionario ? funcionario.nome : "N/A"
                            }</td>
                            <td class="p-3">${
                              treinamento ? treinamento.descricao : "N/A"
                            }</td>
                            <td class="p-3">${
                              instrutor ? instrutor.nome : "N/A"
                            }</td>
                            <td class="p-3">${formatarData(
                              h.dataTreinamento
                            )}</td>
                            <td class="p-3">${formatarData(h.dataValidade)}</td>
                            <td class="p-3">${statusBadge}</td>
                            <td class="p-3">
                                <button class="action-btn edit-btn mr-1" onclick="verCertificado(${
                                  h.id
                                })">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deletarHistoricoTreinamento(${
                                  h.id
                                })">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
            })
            .join("");
        };

        const setTodayDate = () => {
          const dateInput = document.getElementById("lancamento-data");
          if (dateInput) {
            const today = new Date().toISOString().split("T")[0];
            dateInput.value = today;
          }
        };

        const renderAll = () => {
          renderEmployeeTable();
          renderCargosTable();
          renderNrsTable();
          renderTreinamentosTable();
          renderInstrutoresTable();
          renderClientesTable();
          renderProjetosTable();
          renderTurmasTable();
          renderCargosDatalist();
          renderMaesDatalist();
          renderCertificadoSelects();
          renderHistoricoTreinamentosTable();
        };

        // --- FILTROS ---
        const filterEmployeeTable = () => {
          const filterNome = document
            .getElementById("filter-nome")
            .value.toLowerCase();
          const filterCpf = document.getElementById("filter-cpf").value;

          const filteredEmployees = db.funcionarios.filter((funcionario) => {
            const fullName = `${funcionario.nome || ""} ${
              funcionario.sobrenome || ""
            }`.toLowerCase();
            const cpf = funcionario.cpf || "";

            return fullName.includes(filterNome) && cpf.includes(filterCpf);
          });

          renderEmployeeTable(filteredEmployees);
        };

        document
          .getElementById("filter-nome")
          .addEventListener("keyup", filterEmployeeTable);
        document
          .getElementById("filter-cpf")
          .addEventListener("keyup", filterEmployeeTable);
        document
          .getElementById("filtro-historico")
          .addEventListener("keyup", renderHistoricoTreinamentosTable);
        document
          .getElementById("filtro-vencimento")
          .addEventListener("change", renderHistoricoTreinamentosTable);

        // --- ACCORDION FUNCTIONALITY ---
        document.querySelectorAll(".accordion-header").forEach((button) => {
          button.addEventListener("click", function () {
            const panel = this.nextElementSibling;
            const isOpen = panel.classList.contains("show");

            document.querySelectorAll(".panel.show").forEach((openPanel) => {
              if (openPanel !== panel) {
                openPanel.style.maxHeight = null;
                openPanel.classList.remove("show");
              }
            });

            if (isOpen) {
              panel.style.maxHeight = null;
              panel.classList.remove("show");
            } else {
              panel.style.maxHeight = panel.scrollHeight + 40 + "px";
              panel.classList.add("show");
            }
          });
        });

        // --- FORM SUBMISSIONS ---

        // Funcion√°rios
        document
          .getElementById("employee-form")
          .addEventListener("submit", (e) => {
            e.preventDefault();

            const formData = new FormData(e.target);
            const funcionarioData = {};

            document
              .querySelectorAll("#employee-form input, #employee-form select")
              .forEach((input) => {
                if (input.id && input.value) {
                  funcionarioData[input.id] = input.value;
                }
              });

            if (!funcionarioData.nome) {
              showToast("Nome √© obrigat√≥rio", true);
              return;
            }

            if (modoEdicao && itemEmEdicao) {
              const funcionario = db.funcionarios.find(
                (f) => f.matricula === itemEmEdicao
              );
              if (funcionario) {
                Object.assign(funcionario, funcionarioData);
                showToast("Funcion√°rio atualizado com sucesso!");
              }
            } else {
              funcionarioData.matricula = String(proximaMatricula).padStart(
                4,
                "0"
              );
              funcionarioData.status = funcionarioData.status || "ativo";
              funcionarioData.classificacao =
                funcionarioData.classificacao || "Direto";

              db.funcionarios.push(funcionarioData);
              proximaMatricula++;
              showToast("Funcion√°rio cadastrado com sucesso!");
            }

            saveDB();
            renderEmployeeTable();
            renderMaesDatalist();
            resetForm("employee-form");
            atualizarDisplayMatricula();
          });

        // Cargos
        document
          .getElementById("cargo-form")
          .addEventListener("submit", (e) => {
            e.preventDefault();

            const nome = document.getElementById("cargo-nome").value.trim();

            if (!nome) {
              showToast("Nome do cargo √© obrigat√≥rio", true);
              return;
            }

            if (
              db.cargos.some((c) => c.nome.toLowerCase() === nome.toLowerCase())
            ) {
              showToast("Este cargo j√° existe", true);
              return;
            }

            if (modoEdicao && itemEmEdicao) {
              const cargo = db.cargos.find((c) => c.id === itemEmEdicao);
              if (cargo) {
                cargo.nome = nome;
                showToast("Cargo atualizado com sucesso!");
              }
            } else {
              db.cargos.push({
                id: getNextId(db.cargos),
                nome: nome,
              });
              showToast("Cargo cadastrado com sucesso!");
            }

            saveDB();
            renderCargosTable();
            renderCargosDatalist();
            resetForm("cargo-form");
          });

        // NRs
        document.getElementById("nr-form").addEventListener("submit", (e) => {
          e.preventDefault();

          const codigo = document
            .getElementById("nr-codigo")
            .value.trim()
            .toUpperCase();
          const descricao = document
            .getElementById("nr-descricao")
            .value.trim();
          const cargaHoraria = parseInt(
            document.getElementById("nr-carga-horaria").value
          );
          const validade = parseInt(
            document.getElementById("nr-validade").value
          );
          const frequencia = parseInt(
            document.getElementById("nr-frequencia").value
          );
          const objetivo = document.getElementById("nr-objetivo").value.trim();
          const conteudoProgramatico = document
            .getElementById("nr-conteudo-programatico")
            .value.trim();

          if (
            !codigo ||
            !descricao ||
            isNaN(cargaHoraria) ||
            isNaN(validade) ||
            !objetivo ||
            !conteudoProgramatico
          ) {
            showToast("Todos os campos s√£o obrigat√≥rios", true);
            return;
          }

          if (modoEdicao && itemEmEdicao) {
            const nr = db.nrs.find((n) => n.id === itemEmEdicao);
            if (nr) {
              Object.assign(nr, {
                codigo,
                descricao,
                cargaHoraria,
                validade,
                frequencia,
                objetivo,
                conteudoProgramatico,
              });
              showToast("NR atualizada com sucesso!");
            }
          } else {
            if (db.nrs.some((n) => n.codigo === codigo)) {
              showToast("C√≥digo de NR j√° existe", true);
              return;
            }

            db.nrs.push({
              id: getNextId(db.nrs),
              codigo,
              descricao,
              cargaHoraria,
              validade,
              frequencia,
              objetivo,
              conteudoProgramatico,
            });
            showToast("NR cadastrada com sucesso!");
          }

          saveDB();
          renderNrsTable();
          resetForm("nr-form");
        });

        // Treinamentos
        document
          .getElementById("treinamento-form")
          .addEventListener("submit", (e) => {
            e.preventDefault();

            const codigo = document
              .getElementById("te-codigo")
              .value.trim()
              .toUpperCase();
            const descricao = document
              .getElementById("te-descricao")
              .value.trim();
            const cargaHoraria = parseInt(
              document.getElementById("te-carga-horaria").value
            );
            const validade = parseInt(
              document.getElementById("te-validade").value
            );
            const frequencia = parseInt(
              document.getElementById("te-frequencia").value
            );
            const objetivo = document
              .getElementById("te-objetivo")
              .value.trim();
            const conteudoProgramatico = document
              .getElementById("te-conteudo-programatico")
              .value.trim();

            if (
              !codigo ||
              !descricao ||
              isNaN(cargaHoraria) ||
              isNaN(validade) ||
              !objetivo ||
              !conteudoProgramatico
            ) {
              showToast("Todos os campos s√£o obrigat√≥rios", true);
              return;
            }

            if (modoEdicao && itemEmEdicao) {
              const treinamento = db.treinamentos.find(
                (t) => t.id === itemEmEdicao
              );
              if (treinamento) {
                Object.assign(treinamento, {
                  codigo,
                  descricao,
                  cargaHoraria,
                  validade,
                  frequencia,
                  objetivo,
                  conteudoProgramatico,
                });
                showToast("Treinamento atualizado com sucesso!");
              }
            } else {
              if (db.treinamentos.some((t) => t.codigo === codigo)) {
                showToast("C√≥digo de treinamento j√° existe", true);
                return;
              }

              db.treinamentos.push({
                id: getNextId(db.treinamentos),
                codigo,
                descricao,
                cargaHoraria,
                validade,
                frequencia,
                objetivo,
                conteudoProgramatico,
              });
              showToast("Treinamento cadastrado com sucesso!");
            }

            saveDB();
            renderTreinamentosTable();
            resetForm("treinamento-form");
          });

        // Instrutores
        document
          .getElementById("instrutor-form")
          .addEventListener("submit", (e) => {
            e.preventDefault();

            const nome = document.getElementById("instrutor-nome").value.trim();
            const cpf = document.getElementById("instrutor-cpf").value.trim();
            const habilitacao = document
              .getElementById("instrutor-habilitacao")
              .value.trim();

            if (!nome || !cpf || !habilitacao) {
              showToast("Todos os campos s√£o obrigat√≥rios", true);
              return;
            }

            if (modoEdicao && itemEmEdicao) {
              const instrutor = db.instrutores.find(
                (i) => i.id === itemEmEdicao
              );
              if (instrutor) {
                Object.assign(instrutor, { nome, cpf, habilitacao });
                showToast("Instrutor atualizado com sucesso!");
              }
            } else {
              db.instrutores.push({
                id: getNextId(db.instrutores),
                nome,
                cpf,
                habilitacao,
              });
              showToast("Instrutor cadastrado com sucesso!");
            }

            saveDB();
            renderInstrutoresTable();
            resetForm("instrutor-form");
          });

        // Clientes
        document
          .getElementById("cliente-form")
          .addEventListener("submit", (e) => {
            e.preventDefault();

            const nome = document.getElementById("cliente-nome").value.trim();
            const cidade = document
              .getElementById("cliente-cidade")
              .value.trim();
            const estado = document
              .getElementById("cliente-estado")
              .value.trim()
              .toUpperCase();

            if (!nome) {
              showToast("Nome do cliente √© obrigat√≥rio", true);
              return;
            }

            if (modoEdicao && itemEmEdicao) {
              const cliente = db.clientes.find((c) => c.id === itemEmEdicao);
              if (cliente) {
                Object.assign(cliente, { nome, cidade, estado });
                showToast("Cliente atualizado com sucesso!");
              }
            } else {
              db.clientes.push({
                id: getNextId(db.clientes),
                nome,
                cidade,
                estado,
              });
              showToast("Cliente cadastrado com sucesso!");
            }

            saveDB();
            renderClientesTable();
            renderClientesSelect();
            resetForm("cliente-form");
          });

        // Projetos
        document
          .getElementById("projeto-form")
          .addEventListener("submit", (e) => {
            e.preventDefault();

            const numero = parseInt(
              document.getElementById("projeto-numero").value
            );
            const descricao = document
              .getElementById("projeto-descricao")
              .value.trim();
            const clienteId = parseInt(
              document.getElementById("projeto-cliente").value
            );

            if (isNaN(numero) || !descricao || isNaN(clienteId)) {
              showToast("Todos os campos s√£o obrigat√≥rios", true);
              return;
            }

            if (modoEdicao && itemEmEdicao) {
              const projeto = db.projetos.find((p) => p.id === itemEmEdicao);
              if (projeto) {
                Object.assign(projeto, { numero, descricao, clienteId });
                showToast("Projeto atualizado com sucesso!");
              }
            } else {
              if (db.projetos.some((p) => p.numero === numero)) {
                showToast("N√∫mero de projeto j√° existe", true);
                return;
              }

              db.projetos.push({
                id: getNextId(db.projetos),
                numero,
                descricao,
                clienteId,
              });
              showToast("Projeto cadastrado com sucesso!");
            }

            saveDB();
            renderProjetosTable();
            renderProjetosSelect();
            resetForm("projeto-form");
          });

        // Turmas
        document
          .getElementById("turma-form")
          .addEventListener("submit", (e) => {
            e.preventDefault();

            const codinome = document
              .getElementById("turma-codinome")
              .value.trim();
            const descricao = document
              .getElementById("turma-descricao")
              .value.trim();
            const horarioEntrada =
              document.getElementById("turma-entrada").value;
            const horarioSaida = document.getElementById("turma-saida").value;

            if (!codinome) {
              showToast("Codinome da turma √© obrigat√≥rio", true);
              return;
            }

            if (modoEdicao && itemEmEdicao) {
              const turma = db.turmas.find((t) => t.id === itemEmEdicao);
              if (turma) {
                Object.assign(turma, {
                  codinome,
                  descricao,
                  horarioEntrada,
                  horarioSaida,
                });
                showToast("Turma atualizada com sucesso!");
              }
            } else {
              if (
                db.turmas.some(
                  (t) => t.codinome.toLowerCase() === codinome.toLowerCase()
                )
              ) {
                showToast("Codinome de turma j√° existe", true);
                return;
              }

              db.turmas.push({
                id: getNextId(db.turmas),
                codinome,
                descricao,
                horarioEntrada,
                horarioSaida,
                membros: [],
              });
              showToast("Turma cadastrada com sucesso!");
            }

            saveDB();
            renderTurmasTable();
            renderTurmasSelect();
            resetForm("turma-form");
          });

        // Certificados
        document
          .getElementById("certificado-form")
          .addEventListener("submit", (e) => {
            e.preventDefault();

            const matriculaFuncionario = document.getElementById(
              "certificado-funcionario"
            ).value;
            const tipoTreinamento = document.getElementById(
              "certificado-treinamento-tipo"
            ).value;
            const idTreinamento = parseInt(
              document.getElementById("certificado-treinamento").value
            );
            const idInstrutor = parseInt(
              document.getElementById("certificado-instrutor").value
            );
            const dataTreinamento =
              document.getElementById("certificado-data").value;

            if (
              !matriculaFuncionario ||
              !tipoTreinamento ||
              !idTreinamento ||
              !idInstrutor ||
              !dataTreinamento
            ) {
              showToast("Preencha todos os campos obrigat√≥rios", true);
              return;
            }

            const existeCertificado = db.historicoTreinamentos.some(
              (h) =>
                h.matriculaFuncionario === matriculaFuncionario &&
                h.tipoTreinamento === tipoTreinamento &&
                h.idTreinamento === idTreinamento &&
                h.dataTreinamento === dataTreinamento
            );

            if (existeCertificado) {
              showToast(
                "J√° existe um certificado para este funcion√°rio, treinamento e data.",
                true
              );
              return;
            }

            const treinamento =
              tipoTreinamento === "nr"
                ? db.nrs.find((n) => n.id === idTreinamento)
                : db.treinamentos.find((t) => t.id === idTreinamento);

            const dataValidade = adicionarMeses(
              dataTreinamento,
              treinamento.validade
            );

            const novoHistorico = {
              id: getNextId(db.historicoTreinamentos),
              matriculaFuncionario,
              tipoTreinamento,
              idTreinamento,
              idInstrutor,
              dataTreinamento,
              dataValidade,
            };

            db.historicoTreinamentos.push(novoHistorico);
            saveDB();
            showToast("Certificado gerado e hist√≥rico salvo com sucesso!");
            renderHistoricoTreinamentosTable();
            resetForm("certificado-form");
            gerarCertificado(novoHistorico.id);
          });

        // --- FUN√á√ïES DE EDI√á√ÉO E EXCLUS√ÉO ---
        const resetForm = (formId) => {
          document.getElementById(formId).reset();
          modoEdicao = false;
          itemEmEdicao = null;

          if (formId === "employee-form") {
            atualizarDisplayMatricula();
          }
          if (formId === "certificado-form") {
            document.getElementById("certificado-treinamento").disabled = true;
          }
        };

        window.editEmployee = (matricula) => {
          const funcionario = db.funcionarios.find(
            (f) => f.matricula === matricula
          );
          if (!funcionario) return;

          modoEdicao = true;
          itemEmEdicao = matricula;

          Object.keys(funcionario).forEach((key) => {
            const input = document.getElementById(key);
            if (input) {
              input.value = funcionario[key] || "";
            }
          });

          switchView("funcionarios");
          showToast(
            "Editando funcion√°rio. Altere os dados e clique em salvar."
          );
        };

        window.deleteEmployee = (matricula) => {
          if (confirm("Tem certeza que deseja excluir este funcion√°rio?")) {
            db.funcionarios = db.funcionarios.filter(
              (f) => f.matricula !== matricula
            );
            saveDB();
            renderEmployeeTable();
            renderMaesDatalist();
            showToast("Funcion√°rio exclu√≠do com sucesso!");
          }
        };

        window.editCargo = (id) => {
          const cargo = db.cargos.find((c) => c.id === id);
          if (!cargo) return;

          modoEdicao = true;
          itemEmEdicao = id;
          document.getElementById("cargo-nome").value = cargo.nome;
          switchView("cargos");
        };

        window.deleteCargo = (id) => {
          if (confirm("Tem certeza que deseja excluir este cargo?")) {
            db.cargos = db.cargos.filter((c) => c.id !== id);
            saveDB();
            renderCargosTable();
            renderCargosDatalist();
            showToast("Cargo exclu√≠do com sucesso!");
          }
        };

        window.editNr = (id) => {
          const nr = db.nrs.find((n) => n.id === id);
          if (!nr) return;

          modoEdicao = true;
          itemEmEdicao = id;
          document.getElementById("nr-codigo").value = nr.codigo;
          document.getElementById("nr-descricao").value = nr.descricao;
          document.getElementById("nr-carga-horaria").value = nr.cargaHoraria;
          document.getElementById("nr-validade").value = nr.validade;
          document.getElementById("nr-frequencia").value = nr.frequencia;
          document.getElementById("nr-objetivo").value = nr.objetivo;
          document.getElementById("nr-conteudo-programatico").value =
            nr.conteudoProgramatico;
          switchView("nrs");
        };

        window.deleteNr = (id) => {
          if (confirm("Tem certeza que deseja excluir esta NR?")) {
            db.nrs = db.nrs.filter((n) => n.id !== id);
            saveDB();
            renderNrsTable();
            showToast("NR exclu√≠da com sucesso!");
          }
        };

        window.editTreinamento = (id) => {
          const treinamento = db.treinamentos.find((t) => t.id === id);
          if (!treinamento) return;

          modoEdicao = true;
          itemEmEdicao = id;
          document.getElementById("te-codigo").value = treinamento.codigo;
          document.getElementById("te-descricao").value = treinamento.descricao;
          document.getElementById("te-carga-horaria").value =
            treinamento.cargaHoraria;
          document.getElementById("te-validade").value = treinamento.validade;
          document.getElementById("te-frequencia").value =
            treinamento.frequencia;
          document.getElementById("te-objetivo").value = treinamento.objetivo;
          document.getElementById("te-conteudo-programatico").value =
            treinamento.conteudoProgramatico;
          switchView("treinamentos");
        };

        window.deleteTreinamento = (id) => {
          if (confirm("Tem certeza que deseja excluir este treinamento?")) {
            db.treinamentos = db.treinamentos.filter((t) => t.id !== id);
            saveDB();
            renderTreinamentosTable();
            showToast("Treinamento exclu√≠do com sucesso!");
          }
        };

        window.editInstrutor = (id) => {
          const instrutor = db.instrutores.find((i) => i.id === id);
          if (!instrutor) return;

          modoEdicao = true;
          itemEmEdicao = id;
          document.getElementById("instrutor-nome").value = instrutor.nome;
          document.getElementById("instrutor-cpf").value = instrutor.cpf;
          document.getElementById("instrutor-habilitacao").value =
            instrutor.habilitacao;
          switchView("instrutores");
        };

        window.deleteInstrutor = (id) => {
          if (confirm("Tem certeza que deseja excluir este instrutor?")) {
            db.instrutores = db.instrutores.filter((i) => i.id !== id);
            saveDB();
            renderInstrutoresTable();
            showToast("Instrutor exclu√≠do com sucesso!");
          }
        };

        window.editCliente = (id) => {
          const cliente = db.clientes.find((c) => c.id === id);
          if (!cliente) return;

          modoEdicao = true;
          itemEmEdicao = id;
          document.getElementById("cliente-nome").value = cliente.nome;
          document.getElementById("cliente-cidade").value =
            cliente.cidade || "";
          document.getElementById("cliente-estado").value =
            cliente.estado || "";
          switchView("clientes");
        };

        window.deleteCliente = (id) => {
          if (confirm("Tem certeza que deseja excluir este cliente?")) {
            if (db.projetos.some((p) => p.clienteId === id)) {
              showToast(
                "N√£o √© poss√≠vel excluir. Cliente possui projetos associados.",
                true
              );
              return;
            }

            db.clientes = db.clientes.filter((c) => c.id !== id);
            saveDB();
            renderClientesTable();
            renderClientesSelect();
            showToast("Cliente exclu√≠do com sucesso!");
          }
        };

        window.editProjeto = (id) => {
          const projeto = db.projetos.find((p) => p.id === id);
          if (!projeto) return;

          modoEdicao = true;
          itemEmEdicao = id;
          document.getElementById("projeto-numero").value = projeto.numero;
          document.getElementById("projeto-descricao").value =
            projeto.descricao;
          document.getElementById("projeto-cliente").value = projeto.clienteId;
          switchView("projetos");
        };

        window.deleteProjeto = (id) => {
          if (confirm("Tem certeza que deseja excluir este projeto?")) {
            if (db.horarios.some((h) => h.projetoId === id)) {
              showToast(
                "N√£o √© poss√≠vel excluir. Projeto possui horas lan√ßadas.",
                true
              );
              return;
            }

            db.projetos = db.projetos.filter((p) => p.id !== id);
            saveDB();
            renderProjetosTable();
            renderProjetosSelect();
            showToast("Projeto exclu√≠do com sucesso!");
          }
        };

        window.editTurma = (id) => {
          const turma = db.turmas.find((t) => t.id === id);
          if (!turma) return;

          modoEdicao = true;
          itemEmEdicao = id;
          document.getElementById("turma-codinome").value = turma.codinome;
          document.getElementById("turma-descricao").value =
            turma.descricao || "";
          document.getElementById("turma-entrada").value = turma.horarioEntrada;
          document.getElementById("turma-saida").value = turma.horarioSaida;
          switchView("turmas");
        };

        window.deleteTurma = (id) => {
          if (confirm("Tem certeza que deseja excluir esta turma?")) {
            if (db.horarios.some((h) => h.turmaId === id)) {
              showToast(
                "N√£o √© poss√≠vel excluir. Turma possui horas lan√ßadas.",
                true
              );
              return;
            }

            db.turmas = db.turmas.filter((t) => t.id !== id);
            saveDB();
            renderTurmasTable();
            renderTurmasSelect();
            showToast("Turma exclu√≠da com sucesso!");
          }
        };

        window.deletarHistoricoTreinamento = (id) => {
          if (
            confirm(
              "Tem certeza que deseja excluir este registro de treinamento?"
            )
          ) {
            db.historicoTreinamentos = db.historicoTreinamentos.filter(
              (h) => h.id !== id
            );
            saveDB();
            renderHistoricoTreinamentosTable();
            showToast("Registro de treinamento exclu√≠do com sucesso!");
          }
        };

        // --- GERENCIAMENTO DE MEMBROS DAS TURMAS ---
        window.gerenciarMembros = (turmaId) => {
          const turma = db.turmas.find((t) => t.id === turmaId);
          if (!turma) return;

          if (!turma.membros) turma.membros = [];

          const membrosDaTurma = db.funcionarios.filter(
            (f) => turma.membros.includes(f.matricula) && f.status === "ativo"
          );

          const matriculasAlocadas = db.turmas.flatMap((t) => t.membros || []);

          const funcionariosDisponiveis = db.funcionarios.filter(
            (f) =>
              !matriculasAlocadas.includes(f.matricula) && f.status === "ativo"
          );

          const title = `Gerenciar Membros: ${turma.codinome}`;
          const bodyHtml = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6" data-turma-id="${turmaId}">
                        <div>
                            <h4 class="font-semibold mb-3 text-green-700">
                                <i class="fas fa-user-plus mr-2"></i>Funcion√°rios Dispon√≠veis
                            </h4>
                            <div class="border rounded-lg p-3 h-64 overflow-y-auto bg-green-50">
                                ${
                                  funcionariosDisponiveis.length > 0
                                    ? funcionariosDisponiveis
                                        .map((f) => {
                                          const fullName = `${f.nome || ""} ${
                                            f.sobrenome || ""
                                          }`.trim();
                                          return `
                                            <div class="flex items-center justify-between p-2 hover:bg-white rounded border-b">
                                                <div>
                                                    <span class="font-medium">${fullName}</span>
                                                    <br><small class="text-gray-600">Mat: ${
                                                      f.matricula
                                                    } | ${
                                            f.cargo || "Sem cargo"
                                          }</small>
                                                </div>
                                                <button type="button" class="btn btn-success btn-sm add-membro-btn" data-matricula="${
                                                  f.matricula
                                                }">
                                                    <i class="fas fa-plus"></i> Adicionar
                                                </button>
                                            </div>
                                        `;
                                        })
                                        .join("")
                                    : '<p class="text-gray-500 text-center py-8">Nenhum funcion√°rio dispon√≠vel</p>'
                                }
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold mb-3 text-blue-700">
                                <i class="fas fa-users mr-2"></i>Membros da Turma (${
                                  membrosDaTurma.length
                                })
                            </h4>
                            <div class="border rounded-lg p-3 h-64 overflow-y-auto bg-blue-50" id="membros-turma-list">
                                ${
                                  membrosDaTurma.length > 0
                                    ? membrosDaTurma
                                        .map((f) => {
                                          const fullName = `${f.nome || ""} ${
                                            f.sobrenome || ""
                                          }`.trim();
                                          return `
                                            <div class="flex items-center justify-between p-2 hover:bg-white rounded border-b">
                                                <div>
                                                    <span class="font-medium">${fullName}</span>
                                                    <br><small class="text-gray-600">Mat: ${
                                                      f.matricula
                                                    } | ${
                                            f.cargo || "Sem cargo"
                                          }</small>
                                                </div>
                                                <button type="button" class="btn btn-danger btn-sm remove-membro-btn" data-matricula="${
                                                  f.matricula
                                                }">
                                                    <i class="fas fa-minus"></i> Remover
                                                </button>
                                            </div>
                                        `;
                                        })
                                        .join("")
                                    : '<p class="text-gray-500 text-center py-8">Nenhum membro na turma</p>'
                                }
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 rounded">
                        <p class="text-sm">
                            <i class="fas fa-info-circle mr-2"></i>
                            <strong>Importante:</strong> Cada funcion√°rio pode pertencer a apenas uma turma por vez. 
                            Ao adicionar um funcion√°rio que j√° estava em outra turma, ele ser√° automaticamente removido da turma anterior.
                        </p>
                    </div>
                    
                    <button type="button" id="fechar-membros-btn" class="btn btn-primary w-full mt-4">
                        <i class="fas fa-check mr-2"></i>Concluir
                    </button>
                `;

          openModal(title, bodyHtml);

          document.querySelectorAll(".add-membro-btn").forEach((btn) => {
            btn.addEventListener("click", function () {
              const matricula = this.dataset.matricula;
              adicionarMembroTurma(turmaId, matricula);
            });
          });

          document.querySelectorAll(".remove-membro-btn").forEach((btn) => {
            btn.addEventListener("click", function () {
              const matricula = this.dataset.matricula;
              removerMembroTurma(turmaId, matricula);
            });
          });

          document
            .getElementById("fechar-membros-btn")
            .addEventListener("click", () => {
              closeModal();
              renderTurmasTable();
              showToast("Membros da turma atualizados!");
            });
        };

        const adicionarMembroTurma = (turmaId, matricula) => {
          const turma = db.turmas.find((t) => t.id === turmaId);
          const funcionario = db.funcionarios.find(
            (f) => f.matricula === matricula
          );

          if (!turma || !funcionario) return;

          if (turma.membros && turma.membros.includes(matricula)) {
            showToast("Funcion√°rio j√° √© membro desta turma", true);
            return;
          }

          db.turmas.forEach((t) => {
            if (t.id !== turmaId && t.membros) {
              t.membros = t.membros.filter((m) => m !== matricula);
            }
          });

          if (!turma.membros) turma.membros = [];
          turma.membros.push(matricula);

          saveDB();

          gerenciarMembros(turmaId);

          const nomeCompleto = `${funcionario.nome || ""} ${
            funcionario.sobrenome || ""
          }`.trim();
          showToast(`${nomeCompleto} adicionado √† turma ${turma.codinome}!`);
        };

        const removerMembroTurma = (turmaId, matricula) => {
          const turma = db.turmas.find((t) => t.id === turmaId);
          const funcionario = db.funcionarios.find(
            (f) => f.matricula === matricula
          );

          if (!turma || !funcionario) return;

          const nomeCompleto = `${funcionario.nome || ""} ${
            funcionario.sobrenome || ""
          }`.trim();
          if (
            !confirm(
              `Tem certeza que deseja remover ${nomeCompleto} da turma ${turma.codinome}?`
            )
          ) {
            return;
          }

          if (turma.membros) {
            turma.membros = turma.membros.filter((m) => m !== matricula);
          }

          saveDB();

          gerenciarMembros(turmaId);

          showToast(`${nomeCompleto} removido da turma!`);
        };

        // --- LAN√áAMENTO DE HORAS ---
        document
          .getElementById("carregar-turma-btn")
          .addEventListener("click", () => {
            const turmaId = parseInt(
              document.getElementById("lancamento-turma").value
            );
            const listaDiv = document.getElementById(
              "lista-pessoas-lancamento"
            );

            if (!turmaId) {
              showToast("Selecione uma turma primeiro", true);
              return;
            }

            const turma = db.turmas.find((t) => t.id === turmaId);
            if (!turma || !turma.membros || turma.membros.length === 0) {
              listaDiv.innerHTML =
                '<p class="text-center text-gray-500 mt-4">Esta turma n√£o possui membros.</p>';
              return;
            }

            const funcionariosDaTurma = db.funcionarios.filter(
              (f) => turma.membros.includes(f.matricula) && f.status === "ativo"
            );

            if (funcionariosDaTurma.length === 0) {
              listaDiv.innerHTML =
                '<p class="text-center text-gray-500 mt-4">Esta turma n√£o possui membros ativos.</p>';
              return;
            }

            let html = `
                    <div class="overflow-x-auto mt-4">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b">
                                    <th class="p-3 text-center">Presente</th>
                                    <th class="p-3">Nome</th>
                                    <th class="p-3">Entrada</th>
                                    <th class="p-3">Sa√≠da</th>
                                    <th class="p-3">Horas Trabalhadas</th>
                                </tr>
                            </thead>
                            <tbody id="lancamento-tbody">
                `;

            funcionariosDaTurma.forEach((funcionario) => {
              const fullName = `${funcionario.nome || ""} ${
                funcionario.sobrenome || ""
              }`.trim();
              html += `
                        <tr class="border-b" data-matricula="${funcionario.matricula}">
                            <td class="p-3 text-center">
                                <input type="checkbox" class="presente-check" checked>
                            </td>
                            <td class="p-3 font-medium">${fullName}</td>
                            <td class="p-2">
                                <input type="time" class="hora-entrada w-full rounded-md border-gray-300" value="${turma.horarioEntrada}">
                            </td>
                            <td class="p-2">
                                <input type="time" class="hora-saida w-full rounded-md border-gray-300" value="${turma.horarioSaida}">
                            </td>
                            <td class="p-3 font-bold horas-output">--:--</td>
                        </tr>
                    `;
            });

            html += `
                            </tbody>
                        </table>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">* 1 hora de almo√ßo √© deduzida automaticamente do total.</p>
                    <button id="salvar-lancamentos-btn" class="btn btn-success mt-6 w-full">
                        <i class="fas fa-save mr-2"></i>Salvar Lan√ßamentos
                    </button>
                `;

            listaDiv.innerHTML = html;

            updateAllHoras();

            document
              .querySelectorAll(".hora-entrada, .hora-saida, .presente-check")
              .forEach((input) => {
                input.addEventListener("change", updateAllHoras);
                input.addEventListener("input", updateAllHoras);
              });

            document
              .getElementById("salvar-lancamentos-btn")
              .addEventListener("click", salvarLancamentos);
          });

        const updateAllHoras = () => {
          document.querySelectorAll("#lancamento-tbody tr").forEach((row) => {
            const presenteCheck = row.querySelector(".presente-check");
            const entradaInput = row.querySelector(".hora-entrada");
            const saidaInput = row.querySelector(".hora-saida");
            const horasOutput = row.querySelector(".horas-output");

            if (!presenteCheck.checked) {
              horasOutput.textContent = "AUSENTE";
              horasOutput.style.color = "#dc3545";
              entradaInput.disabled = true;
              saidaInput.disabled = true;
              return;
            }

            entradaInput.disabled = false;
            saidaInput.disabled = false;
            horasOutput.style.color = "";

            const entrada = entradaInput.value;
            const saida = saidaInput.value;

            if (entrada && saida) {
              const entradaMs = new Date(`1970-01-01T${entrada}:00`).getTime();
              const saidaMs = new Date(`1970-01-01T${saida}:00`).getTime();

              if (saidaMs > entradaMs) {
                const diffMs = saidaMs - entradaMs;
                const diffHours = diffMs / (1000 * 60 * 60);
                const horasTrabalhadas =
                  diffHours > 6 ? diffHours - 1 : diffHours;
                const hours = Math.floor(horasTrabalhadas);
                const minutes = Math.round((horasTrabalhadas - hours) * 60);
                horasOutput.textContent = `${hours
                  .toString()
                  .padStart(2, "0")}:${minutes
                  .toString()
                  .padStart(2, "0")} (${horasTrabalhadas.toFixed(2)}h)`;
              } else {
                horasOutput.textContent = "Hor√°rio inv√°lido";
                horasOutput.style.color = "#dc3545";
              }
            } else {
              horasOutput.textContent = "--:--";
            }
          });
        };

        const salvarLancamentos = () => {
          const data = document.getElementById("lancamento-data").value;
          const turmaId = parseInt(
            document.getElementById("lancamento-turma").value
          );
          const projetoId = parseInt(
            document.getElementById("lancamento-projeto").value
          );

          if (!data || !turmaId || !projetoId) {
            showToast("Preencha data, turma e projeto", true);
            return;
          }

          let salvos = 0;
          let duplicados = [];

          document.querySelectorAll("#lancamento-tbody tr").forEach((row) => {
            const matricula = row.dataset.matricula;
            const presenteCheck = row.querySelector(".presente-check");

            if (presenteCheck.checked) {
              const funcionario = db.funcionarios.find(
                (f) => f.matricula === matricula
              );
              if (!funcionario) return;

              if (
                db.horarios.some(
                  (h) => h.data === data && h.funcionarioMatricula === matricula
                )
              ) {
                duplicados.push(
                  `${funcionario.nome} ${funcionario.sobrenome}`.trim()
                );
                return;
              }

              const entrada = row.querySelector(".hora-entrada").value;
              const saida = row.querySelector(".hora-saida").value;

              const entradaMs = new Date(`1970-01-01T${entrada}:00`).getTime();
              const saidaMs = new Date(`1970-01-01T${saida}:00`).getTime();

              if (saidaMs > entradaMs) {
                const diffHours = (saidaMs - entradaMs) / (1000 * 60 * 60);
                const horasTrabalhadas =
                  diffHours > 6 ? diffHours - 1 : diffHours;

                db.horarios.push({
                  id: getNextId(db.horarios),
                  data: data,
                  turmaId: turmaId,
                  projetoId: projetoId,
                  funcionarioMatricula: matricula,
                  horaEntrada: entrada,
                  horaSaida: saida,
                  horasTrabalhadas: parseFloat(horasTrabalhadas.toFixed(2)),
                });

                salvos++;
              }
            }
          });

          if (salvos > 0) {
            saveDB();
            showToast(`${salvos} lan√ßamento(s) salvo(s) com sucesso!`);
            document.getElementById("lista-pessoas-lancamento").innerHTML = "";
          }

          if (duplicados.length > 0) {
            showToast(
              `Aten√ß√£o: ${duplicados.join(
                ", "
              )} j√° possui(em) horas lan√ßadas nesta data.`,
              true
            );
          }

          if (salvos === 0 && duplicados.length === 0) {
            showToast("Nenhuma pessoa presente para lan√ßar horas", true);
          }
        };

        // --- FUN√á√ïES DE CERTIFICADOS ---
        window.gerarCertificado = (idHistorico) => {
          const historico = db.historicoTreinamentos.find(
            (h) => h.id === idHistorico
          );
          if (!historico) {
            showToast("Hist√≥rico de treinamento n√£o encontrado.", true);
            return;
          }

          const funcionario = db.funcionarios.find(
            (f) => f.matricula === historico.matriculaFuncionario
          );
          if (!funcionario) {
            showToast("Funcion√°rio n√£o encontrado.", true);
            return;
          }

          let treinamento = null;
          if (historico.tipoTreinamento === "nr") {
            treinamento = db.nrs.find((n) => n.id === historico.idTreinamento);
          } else {
            treinamento = db.treinamentos.find(
              (t) => t.id === historico.idTreinamento
            );
          }
          if (!treinamento) {
            showToast("Treinamento n√£o encontrado.", true);
            return;
          }

          const instrutor = db.instrutores.find(
            (i) => i.id === historico.idInstrutor
          );
          if (!instrutor) {
            showToast("Instrutor n√£o encontrado.", true);
            return;
          }

          // Gerar n√∫mero do documento
          const [ano, mes, dia] = historico.dataTreinamento.split("-");
          const codigoTreinamento = treinamento.codigo.replace("-", "-");
          const numeroDocumento = `${funcionario.matricula}-${codigoTreinamento}-${ano}_${mes}_${dia}`;

          // Preparar itens do conte√∫do program√°tico sem marcadores
          const conteudoItens = treinamento.conteudoProgramatico
            .split(";")
            .map((item) => item.trim())
            .filter((item) => item.length > 0)
            .map((item) => `‚Ä¢ ${item}`)
            .join("<br>");

          const conteudoCertificado = `
                    <div class="certificado-container">
                        <div class="certificado-logo">
                            <h1 class="text-4xl font-bold" style="color: #045696;">PROSSEN</h1>
                            <p class="text-base text-gray-600 mt-1">Treinamentos e Certifica√ß√µes</p>
                        </div>
                        <h2 class="certificado-header">CERTIFICADO DE PARTICIPA√á√ÉO</h2>
                        <div class="certificado-body">
                            <p class="text-center">Certificamos que</p>
                            <p style="text-align: justify; text-justify: inter-word;">
                                Colaborador da BORCAMBILLOS PROJETOS E SISTEMAS ENGENHEIRADOS LTDA - CNPJ 24.108.352/0001-23, 
                                <b>${(funcionario.nome || "").toUpperCase()} ${(
            funcionario.sobrenome || ""
          ).toUpperCase()}</b> portador do CPF <b>${funcionario.cpf}</b>, 
                                concluiu com aproveitamento o curso Norma Regulamentadora (Treinamento) N¬∫${
                                  treinamento.codigo.split("-")[1]
                                } - ${treinamento.descricao}.
                            </p>


                            <p class="mt-8 font-semibold" style="margin-top: 2rem;">O objetivo do treinamento foi:</p>
                            <p class="italic text-gray-700" style="font-style: italic; color: #374151; text-align: justify;">${
                              treinamento.objetivo
                            }</p>


                            <p class="mt-4 font-semibold" style="margin-top: 1.5rem;">O conte√∫do program√°tico abordado incluiu:</p>
                            <div class="certificado-content-list" style="line-height: 1.8;">
                                ${conteudoItens}
                            </div>
                        </div>
                        <div class="certificado-footer">
                            <div class="assinatura">
                                <div class="assinatura-linha"></div>
                                <div class="assinatura-dados">
                                    <strong>${(
                                      funcionario.nome || ""
                                    ).toUpperCase()} ${(
            funcionario.sobrenome || ""
          ).toUpperCase()}</strong><br>
                                    CPF: ${funcionario.cpf}
                                </div>
                            </div>
                            <div class="assinatura">
                                <div class="assinatura-linha"></div>
                                <div class="assinatura-dados">
                                    <strong>${(
                                      instrutor.nome || ""
                                    ).toUpperCase()}</strong><br>
                                    CPF: ${instrutor.cpf}<br>
                                    ${instrutor.habilitacao}
                                </div>
                            </div>
                        </div>
                        <div class="certificado-footer assinatura-data">
                            <p>
                                Ponta Grossa, PR, ${formatarDataExtenso(
                                  historico.dataTreinamento
                                )}.<br>
                                Validade: ${treinamento.validade} meses<br>
                                <small>Documento: ${numeroDocumento}</small>
                            </p>
                        </div>
                    </div>
                `;

          openCertificadoModal(conteudoCertificado);

          // Atualizar o texto do bot√£o de impress√£o com o nome do arquivo
          const btnImprimir = document.getElementById(
            "imprimir-certificado-btn"
          );
          btnImprimir.setAttribute("data-filename", numeroDocumento);
          btnImprimir.innerHTML = `<i class="fas fa-print mr-2"></i>Imprimir/Salvar PDF (${numeroDocumento}.pdf)`;
        };

        window.verCertificado = (id) => {
          gerarCertificado(id);
        };

        // --- EXPORTA√á√ÉO E IMPORTA√á√ÉO DE TABELAS INDIVIDUAIS ---

        window.exportarTabela = (nomeTabela) => {
          if (!db[nomeTabela]) {
            showToast("Tabela n√£o encontrada", true);
            return;
          }

          const dados = db[nomeTabela];
          if (dados.length === 0) {
            showToast("N√£o h√° dados para exportar nesta tabela", true);
            return;
          }

          const dataStr = JSON.stringify(dados, null, 2);
          const dataBlob = new Blob([dataStr], { type: "application/json" });
          const url = URL.createObjectURL(dataBlob);
          const link = document.createElement("a");
          const date = new Date().toISOString().slice(0, 10);
          link.download = `${nomeTabela}_${date}.json`;
          link.href = url;
          link.click();
          URL.revokeObjectURL(url);
          showToast(
            `Tabela "${nomeTabela}" exportada com sucesso! (${dados.length} registros)`
          );
        };

        window.exportarTodasTabelas = () => {
          const tabelas = [
            "funcionarios",
            "cargos",
            "nrs",
            "treinamentos",
            "instrutores",
            "clientes",
            "projetos",
            "turmas",
            "horarios",
            "historicoTreinamentos",
          ];
          let totalExportados = 0;

          tabelas.forEach((tabela) => {
            if (db[tabela] && db[tabela].length > 0) {
              const dataStr = JSON.stringify(db[tabela], null, 2);
              const dataBlob = new Blob([dataStr], {
                type: "application/json",
              });
              const url = URL.createObjectURL(dataBlob);
              const link = document.createElement("a");
              const date = new Date().toISOString().slice(0, 10);
              link.download = `${tabela}_${date}.json`;
              link.href = url;
              link.click();
              URL.revokeObjectURL(url);
              totalExportados++;

              // Pequeno delay entre downloads para evitar bloqueio do navegador
              setTimeout(() => {}, 100);
            }
          });

          if (totalExportados > 0) {
            showToast(`${totalExportados} tabelas exportadas com sucesso!`);
          } else {
            showToast("Nenhuma tabela com dados para exportar", true);
          }
        };

        const importarTabela = (nomeTabela, fileInput) => {
          fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (event) => {
                try {
                  const dadosImportados = JSON.parse(event.target.result);

                  if (!Array.isArray(dadosImportados)) {
                    showToast(
                      "Formato de arquivo inv√°lido. Esperado um array JSON.",
                      true
                    );
                    return;
                  }

                  if (dadosImportados.length === 0) {
                    showToast("Arquivo vazio, nenhum dado para importar", true);
                    return;
                  }

                  // Valida√ß√£o espec√≠fica por tabela
                  let dadosValidos = [];
                  let dadosInvalidos = 0;

                  dadosImportados.forEach((item) => {
                    // Valida√ß√µes b√°sicas
                    if (typeof item !== "object" || item === null) {
                      dadosInvalidos++;
                      return;
                    }

                    // Para tabelas com ID, verificar se j√° existe
                    if (nomeTabela !== "funcionarios") {
                      if (
                        item.id &&
                        db[nomeTabela].some(
                          (existing) => existing.id === item.id
                        )
                      ) {
                        // Se j√° existe, pular (ou poderia atualizar)
                        dadosInvalidos++;
                        return;
                      }
                    } else {
                      // Para funcion√°rios, verificar por matr√≠cula
                      if (
                        item.matricula &&
                        db.funcionarios.some(
                          (f) => f.matricula === item.matricula
                        )
                      ) {
                        dadosInvalidos++;
                        return;
                      }
                    }

                    dadosValidos.push(item);
                  });

                  if (dadosValidos.length > 0) {
                    // Adicionar dados v√°lidos
                    db[nomeTabela].push(...dadosValidos);

                    // Atualizar pr√≥xima matr√≠cula se for funcion√°rios
                    if (nomeTabela === "funcionarios") {
                      proximaMatricula =
                        Math.max(
                          1,
                          ...db.funcionarios.map(
                            (f) => parseInt(f.matricula) || 0
                          )
                        ) + 1;
                      atualizarDisplayMatricula();
                    }

                    saveDB();
                    renderAll();
                    atualizarContagemRegistros();

                    let mensagem = `${dadosValidos.length} registro(s) importado(s) para "${nomeTabela}"`;
                    if (dadosInvalidos > 0) {
                      mensagem += `. ${dadosInvalidos} registro(s) ignorado(s) (duplicados ou inv√°lidos)`;
                    }
                    showToast(mensagem);
                  } else {
                    showToast(
                      "Nenhum dado v√°lido encontrado ou todos s√£o duplicados",
                      true
                    );
                  }
                } catch (error) {
                  console.error("Erro ao importar:", error);
                  showToast(
                    "Erro ao processar arquivo. Verifique o formato.",
                    true
                  );
                }
              };
              reader.readAsText(file);
            }
            fileInput.value = "";
          };
          fileInput.click();
        };

        const atualizarContagemRegistros = () => {
          // Contadores para importa√ß√£o
          document.getElementById("count-funcionarios").textContent =
            db.funcionarios.length;
          document.getElementById("count-cargos").textContent =
            db.cargos.length;
          document.getElementById("count-nrs").textContent = db.nrs.length;
          document.getElementById("count-treinamentos").textContent =
            db.treinamentos.length;
          document.getElementById("count-instrutores").textContent =
            db.instrutores.length;
          document.getElementById("count-clientes").textContent =
            db.clientes.length;
          document.getElementById("count-projetos").textContent =
            db.projetos.length;
          document.getElementById("count-turmas").textContent =
            db.turmas.length;
          document.getElementById("count-horarios").textContent =
            db.horarios.length;
          document.getElementById("count-historico").textContent =
            db.historicoTreinamentos.length;

          // Contadores para exporta√ß√£o
          document.getElementById("export-count-funcionarios").textContent =
            db.funcionarios.length;
          document.getElementById("export-count-cargos").textContent =
            db.cargos.length;
          document.getElementById("export-count-nrs").textContent =
            db.nrs.length;
          document.getElementById("export-count-treinamentos").textContent =
            db.treinamentos.length;
          document.getElementById("export-count-instrutores").textContent =
            db.instrutores.length;
          document.getElementById("export-count-clientes").textContent =
            db.clientes.length;
          document.getElementById("export-count-projetos").textContent =
            db.projetos.length;
          document.getElementById("export-count-turmas").textContent =
            db.turmas.length;
          document.getElementById("export-count-horarios").textContent =
            db.horarios.length;
          document.getElementById("export-count-historico").textContent =
            db.historicoTreinamentos.length;
        };

        // Event listeners para importa√ß√£o
        document
          .getElementById("import-funcionarios")
          .addEventListener("change", function (e) {
            this.removeEventListener("change", arguments.callee);
            importarTabela("funcionarios", this);
          });

        document
          .getElementById("import-cargos")
          .addEventListener("change", function (e) {
            this.removeEventListener("change", arguments.callee);
            importarTabela("cargos", this);
          });

        document
          .getElementById("import-nrs")
          .addEventListener("change", function (e) {
            this.removeEventListener("change", arguments.callee);
            importarTabela("nrs", this);
          });

        document
          .getElementById("import-treinamentos")
          .addEventListener("change", function (e) {
            this.removeEventListener("change", arguments.callee);
            importarTabela("treinamentos", this);
          });

        document
          .getElementById("import-instrutores")
          .addEventListener("change", function (e) {
            this.removeEventListener("change", arguments.callee);
            importarTabela("instrutores", this);
          });

        document
          .getElementById("import-clientes")
          .addEventListener("change", function (e) {
            this.removeEventListener("change", arguments.callee);
            importarTabela("clientes", this);
          });

        document
          .getElementById("import-projetos")
          .addEventListener("change", function (e) {
            this.removeEventListener("change", arguments.callee);
            importarTabela("projetos", this);
          });

        document
          .getElementById("import-turmas")
          .addEventListener("change", function (e) {
            this.removeEventListener("change", arguments.callee);
            importarTabela("turmas", this);
          });

        document
          .getElementById("import-horarios")
          .addEventListener("change", function (e) {
            this.removeEventListener("change", arguments.callee);
            importarTabela("horarios", this);
          });

        document
          .getElementById("import-historico")
          .addEventListener("change", function (e) {
            this.removeEventListener("change", arguments.callee);
            importarTabela("historicoTreinamentos", this);
          });

        // --- EVENT LISTENERS PARA BACKUP ---
        document
          .getElementById("export-db-btn")
          .addEventListener("click", exportDB);
        document
          .getElementById("import-db-btn")
          .addEventListener("click", importDB);
        document
          .getElementById("reset-db-btn")
          .addEventListener("click", resetDB);

        // --- EVENT LISTENERS PARA RELAT√ìRIOS DE PONTO ---
        document
          .getElementById("aplicar-filtros-btn")
          .addEventListener("click", aplicarFiltrosRelatorio);
        document
          .getElementById("limpar-filtros-btn")
          .addEventListener("click", limparFiltrosRelatorio);

        document
          .getElementById("exportar-csv-relatorio-btn")
          .addEventListener("click", () => {
            const dados = JSON.parse(
              document.getElementById("exportar-csv-relatorio-btn").dataset
                .dadosRelatorio
            );
            if (dados && dados.length > 0) {
              exportarCSVRelatorio(dados);
            } else {
              showToast("Nenhum dado para exportar", true);
            }
          });

        window.editarRegistroPonto = (id) => {
          const registro = db.horarios.find((h) => h.id === id);
          if (!registro) return;

          const funcionario = db.funcionarios.find(
            (f) => f.matricula === registro.funcionarioMatricula
          );
          const title = `Editar Registro de Ponto: ${funcionario.nome} ${funcionario.sobrenome}`;

          const projetosOptions = db.projetos
            .map(
              (p) =>
                `<option value="${p.id}" ${
                  p.id === registro.projetoId ? "selected" : ""
                }>${p.numero} - ${p.descricao}</option>`
            )
            .join("");

          const turmasOptions = db.turmas
            .map(
              (t) =>
                `<option value="${t.id}" ${
                  t.id === registro.turmaId ? "selected" : ""
                }>${t.codinome}</option>`
            )
            .join("");

          const bodyHtml = `
                    <form id="editar-ponto-form" data-id="${id}">
                        <div class="form-group">
                            <label for="modal-data">Data</label>
                            <input type="date" id="modal-data" value="${registro.data}" required>
                        </div>
                        <div class="form-group">
                            <label for="modal-turma">Turma</label>
                            <select id="modal-turma" required>${turmasOptions}</select>
                        </div>
                        <div class="form-group">
                            <label for="modal-projeto">Projeto</label>
                            <select id="modal-projeto" required>${projetosOptions}</select>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="modal-entrada">Entrada</label>
                                <input type="time" id="modal-entrada" value="${registro.horaEntrada}" required>
                            </div>
                            <div class="form-group">
                                <label for="modal-saida">Sa√≠da</label>
                                <input type="time" id="modal-saida" value="${registro.horaSaida}" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary mt-4 w-full">Salvar Altera√ß√µes</button>
                    </form>
                `;

          openModal(title, bodyHtml);

          document
            .getElementById("editar-ponto-form")
            .addEventListener("submit", (e) => {
              e.preventDefault();

              const data = document.getElementById("modal-data").value;
              const turmaId = parseInt(
                document.getElementById("modal-turma").value
              );
              const projetoId = parseInt(
                document.getElementById("modal-projeto").value
              );
              const entrada = document.getElementById("modal-entrada").value;
              const saida = document.getElementById("modal-saida").value;

              const entradaMs = new Date(`1970-01-01T${entrada}:00`).getTime();
              const saidaMs = new Date(`1970-01-01T${saida}:00`).getTime();
              const diffHours = (saidaMs - entradaMs) / (1000 * 60 * 60);
              const horasTrabalhadas =
                diffHours > 6 ? diffHours - 1 : diffHours;

              Object.assign(registro, {
                data,
                turmaId,
                projetoId,
                horaEntrada: entrada,
                horaSaida: saida,
                horasTrabalhadas: parseFloat(horasTrabalhadas.toFixed(2)),
              });

              saveDB();
              closeModal();
              aplicarFiltrosRelatorio();
              showToast("Registro atualizado com sucesso!");
            });
        };

        window.deletarRegistroPonto = (id) => {
          if (
            confirm("Tem certeza que deseja excluir este registro de ponto?")
          ) {
            db.horarios = db.horarios.filter((h) => h.id !== id);
            saveDB();
            aplicarFiltrosRelatorio();
            showToast("Registro exclu√≠do com sucesso!");
          }
        };

        const exportarCSVRelatorio = (dados) => {
          const headers =
            "Data;Funcionario;Turma;Projeto;Entrada;Saida;Horas\n";
          const rows = dados
            .map((h) => {
              const funcionario = db.funcionarios.find(
                (f) => f.matricula === h.funcionarioMatricula
              );
              const turma = db.turmas.find((t) => t.id === h.turmaId);
              const projeto = db.projetos.find((p) => p.id === h.projetoId);
              const nomeFuncionario = funcionario
                ? `${funcionario.nome || ""} ${
                    funcionario.sobrenome || ""
                  }`.trim()
                : `Matr√≠cula: ${h.funcionarioMatricula}`;
              const nomeTurma = turma ? turma.codinome : "N/A";
              const nomeProjeto = projeto
                ? `${projeto.numero} - ${projeto.descricao}`
                : "N/A";
              const dataFormatada = new Date(
                h.data + "T00:00:00"
              ).toLocaleDateString("pt-BR");
              return `${dataFormatada};"${nomeFuncionario}";"${nomeTurma}";"${nomeProjeto}";${
                h.horaEntrada
              };${h.horaSaida};${(h.horasTrabalhadas || 0)
                .toFixed(2)
                .replace(".", ",")}`;
            })
            .join("\n");

          const csvContent =
            "data:text/csv;charset=utf-8,\uFEFF" + headers + rows;
          const encodedUri = encodeURI(csvContent);
          const link = document.createElement("a");
          link.setAttribute("href", encodedUri);
          link.setAttribute(
            "download",
            `relatorio_ponto_${new Date().toISOString().slice(0, 10)}.csv`
          );
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          showToast("Relat√≥rio de Ponto exportado com sucesso!");
        };

        // --- INICIALIZA√á√ÉO ---
        loadDB();
        aplicarMascaras();

        setTimeout(() => {
          const firstPanel = document.querySelector(".panel");
          if (firstPanel) {
            firstPanel.style.maxHeight = firstPanel.scrollHeight + 40 + "px";
          }
        }, 100);

        window.addEventListener("beforeunload", (event) => {
          event.preventDefault();
          event.returnValue =
            "Tem certeza que deseja sair? Considere fazer backup dos seus dados.";
        });

        console.log("Sistema Integrado PROSSEN carregado com sucesso!");
      });
    </script>
  </body>
</html>
